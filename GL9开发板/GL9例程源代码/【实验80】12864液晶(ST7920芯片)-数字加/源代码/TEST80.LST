C51 COMPILER V7.00  TEST80                                                                 09/18/2012 22:36:43 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST80
OBJECT MODULE PLACED IN TEST80.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST80.c

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          #include <Intrins.h>    //因为本例中用到空操作_nop_();所以必须调用这个头文件
  11          
  12          //---------------------------------------
  13          //12864液晶相关I/O设置
  14          sbit RS=P2^0;                   //并行数据/控制字选择 H:数据  L:控制字
  15          sbit RW=P2^1;                   //并行读/写选择       H:读    L:写
  16          sbit E =P2^2;                   //并行读写使能        H有效,下降沿锁定数据
  17          sbit PSB=P2^3;          //串口,并口选择       H:并口  L:串口（开发板上引脚标识为CS1）
  18          sbit RST=P2^5;          //复位引脚            L:液晶复位
  19          sbit DB0=P0^7;                  //
  20          sbit DB1=P0^6;                  //
  21          sbit DB2=P0^5;                  //
  22          sbit DB3=P0^4;                  //
  23          sbit DB4=P0^3;                  //
  24          sbit DB5=P0^2;                  //
  25          sbit DB6=P0^1;                  //
  26          sbit DB7=P0^0;                  //
  27          //---------------------------------------
  28          unsigned char code dis[] = {'0','1','2','3','4','5','6','7','8','9'};
  29          //---------------------------------------
  30          //名称：液晶用延时函数
  31          //适用：给力者GL9单片机开发学习系统
  32          //公司：宁波芯动电子有限公司
  33          //网址：www.MovingChip.com
  34          //日期：20120918
  35          //---------------------------------------
  36          void delay(unsigned int t)
  37          {
  38   1              unsigned int i;
  39   1              for(i=0;i<t;i++);       
  40   1      }
  41          //---------------------------------------
  42          //名称：字节内位数据位置转换函数
  43          //适用：给力者GL9单片机开发学习系统
  44          //公司：宁波芯动电子有限公司
  45          //网址：www.MovingChip.com
  46          //日期：20120918
  47          //---------------------------------------
  48          unsigned char num(unsigned char dat)
  49          {
  50   1         unsigned char val;
  51   1              val = ((dat & 0x01) << 7) | ((dat & 0x02) << 5) | ((dat & 0x04) << 3) | ((dat & 0x08) << 1) |
  52   1         ((dat & 0x10) >> 1) | ((dat & 0x20) >> 3) | ((dat & 0x40) >> 5) | ((dat & 0x80) >> 7);
  53   1         return  val;
  54   1      } 
  55          //---------------------------------------
C51 COMPILER V7.00  TEST80                                                                 09/18/2012 22:36:43 PAGE 2   

  56          //名称：写命令函数
  57          //适用：给力者GL9单片机开发学习系统
  58          //公司：宁波芯动电子有限公司
  59          //网址：www.MovingChip.com
  60          //日期：20120918
  61          //---------------------------------------
  62          void write_com(unsigned char cmdcode)
  63          {               
  64   1              RS=0;                   //设置该字节数据为命令代码
  65   1              RW=1;                   //设置此次操作为读
  66   1              E=1;                    //使能
  67   1              _nop_();                        //空操作，做短暂的延时
  68   1              _nop_();                        //空操作，做短暂的延时
  69   1              E=0;                    //失能
  70   1              RS=0;                   //设置该字节数据为命令代码
  71   1              RW=0;                   //设置此次操作为读写
  72   1              P0=num(cmdcode);                //将命令写入总线
  73   1              _nop_();                        //空操作，做短暂的延时
  74   1              E=1;                            //E的下降沿，数据写入
  75   1              _nop_();                        //空操作，做短暂的延时
  76   1              E=0;                            //E的下降沿，数据写入
  77   1      }
  78          //---------------------------------------
  79          //名称：写数据函数
  80          //适用：给力者GL9单片机开发学习系统
  81          //公司：宁波芯动电子有限公司
  82          //网址：www.MovingChip.com
  83          //日期：20120918
  84          //---------------------------------------
  85          void write_data(unsigned char Rsspdata)
  86          {
  87   1              RS=0;                   //设置该字节数据为命令代码
  88   1              RW=1;                   //设置此次操作为读
  89   1              E=1;                    //使能
  90   1              _nop_();                        //空操作，做短暂的延时
  91   1              _nop_();                        //空操作，做短暂的延时
  92   1              E=0;                    //失能
  93   1              RS=1;                   //设置该字节数据为数据代码
  94   1              RW=0;                   //设置此次操作为读写
  95   1              P0=num(Rsspdata);               //将数据写入总线
  96   1              _nop_();                        //空操作，做短暂的延时
  97   1              E=1;                            //E的下降沿，数据写入
  98   1              _nop_();                        //空操作，做短暂的延时
  99   1              E=0;                            //E的下降沿，数据写入
 100   1      } 
 101          //---------------------------------------
 102          //名称：地址写入函数
 103          //适用：给力者GL9单片机开发学习系统
 104          //公司：宁波芯动电子有限公司
 105          //网址：www.MovingChip.com
 106          //日期：20120918
 107          //---------------------------------------
 108          void write_xy(unsigned char x,unsigned char y)
 109          {
 110   1              unsigned char address;
 111   1              switch(y)
 112   1              {
 113   2                      case 0:address=0x80+x;break;  //第一行的首地址是0x80
 114   2                      case 1:address=0x90+x;break;  //第二行的首地址是0x90
 115   2                      case 2:address=0x88+x;break;  //第三行的首地址是0x88
 116   2                      case 3:address=0x98+x;break;  //第四行的首地址是0x98
 117   2                      default:address=0x80+x;
C51 COMPILER V7.00  TEST80                                                                 09/18/2012 22:36:43 PAGE 3   

 118   2         }
 119   1              write_com(address);     
 120   1      } 
 121          //---------------------------------------
 122          //名称：12864初始化函数
 123          //适用：给力者GL9单片机开发学习系统
 124          //公司：宁波芯动电子有限公司
 125          //网址：www.MovingChip.com
 126          //日期：20120918
 127          //--------------------------------------- 
 128          void init_lcd(void)
 129          {          
 130   1              RST=0;           //复位液晶
 131   1              delay(250);      //加些延时
 132   1              RST=1;           //复位结束
 133   1              delay(250);      //加些延时
 134   1              PSB=1;           //选择8bit并口
 135   1      
 136   1              write_com(0x30);  //基本指令集  
 137   1              write_com(0x0c);  //显示开
 138   1              write_com(0x06);  //光标右移，整体显示不移动
 139   1              write_com(0x01);  //清除显示(清零DDRAM)
 140   1              delay(250);
 141   1      }  
 142          
 143          //---------------------------------------
 144          //名称: 主函数
 145          //适用：给力者GL9单片机开发学习系统
 146          //公司：宁波芯动电子有限公司
 147          //网址：www.MovingChip.com
 148          //日期：20120918
 149          //---------------------------------------       
 150          void main()
 151          {  
 152   1              unsigned int i,k;
 153   1              init_lcd();                                       //初始化液晶  
 154   1              while(1)
 155   1              {                       
 156   2                      if(++i>20000)             //做个延时，不用精确，每20000个计数到，显示数字加一
 157   2              {
 158   3                      i=0;                  //清零为下一个循环做准备
 159   3                      if(++k>50000) k=0;    //显示数据加一，限制最大数为50000，因为设定的是int,最大65535
 160   3                              write_xy(0,0);        //设定开始显示的地址，第一行的第一列
 161   3                      write_data(dis[k/10000]);               //显示万位      
 162   3                              write_data(dis[(k%10000)/1000]);    //显示千位
 163   3                              write_data(dis[(k%1000)/100]);          //显示百位
 164   3                              write_data(dis[(k%100)/10]);            //显示十位
 165   3                              write_data(dis[k%10]);                          //显示个位      
 166   3                      }
 167   2              }
 168   1      }
 169          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    401    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V7.00  TEST80                                                                 09/18/2012 22:36:43 PAGE 4   

END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
