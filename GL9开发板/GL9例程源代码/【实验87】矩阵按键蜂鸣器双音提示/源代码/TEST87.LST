C51 COMPILER V7.00  TEST87                                                                 09/25/2013 10:43:29 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST87
OBJECT MODULE PLACED IN TEST87.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST87.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          unsigned char BeepCon;
  11          bit Beepbit;
  12          bit BeepTwobit; 
  13          //---------------------------------------
  14          //数码管字形表，供显示时查询
  15          unsigned char code LED[10]=
  16          {                          //定义表格一定要使用code，这样会做到程序存储区中
  17              0x3F,                  //"0"的字形表，0B00111111
  18              0x06,                  //"1"的字形表，0B00000110
  19              0x5B,                  //"2"的字形表，0B01011011
  20              0x4F,                  //"3"的字形表，0B01001111
  21              0x66,                  //"4"的字形表，0B01100110
  22              0x6D,                  //"5"的字形表，0B01101101
  23              0x7D,                  //"6"的字形表，0B01111101
  24              0x07,                  //"7"的字形表，0B00000111
  25              0x7F,                  //"8"的字形表，0B01111111
  26              0x6F,                  //"9"的字形表，0B01101111
  27          };
  28          //---------------------------------------
  29          //名称: 按键扫描函数
  30          //适用：给力者GL9单片机开发学习系统
  31          //公司：宁波芯动电子有限公司
  32          //网址：www.MovingChip.com
  33          //日期：20130924
  34          //---------------------------------------
  35          unsigned char ScanKey(void)
  36          {
  37   1               //***4×4矩阵按键扫描部分***
  38   1          //按K1-K16键，返回参数1-16
  39   1               P1=0xFE;                       //将第一行置零，以扫描K1-K4是否被按下
  40   1          if(P1_4==0) return 1;       //如果K1键按下，返回1
  41   1          else if(P1_5==0) return 2;  //如果K2键按下，返回2
  42   1          else if(P1_6==0) return 3;  //如果K3键按下，返回3
  43   1          else if(P1_7==0) return 4;  //如果K4键按下，返回4
  44   1      
  45   1          P1=0xFD;                    //将第二行置零，以扫描K5-K8是否被按下
  46   1          if(P1_4==0) return 5;       //如果K5键按下，返回5
  47   1          else if(P1_5==0) return 6;  //如果K6键按下，返回6
  48   1          else if(P1_6==0) return 7;  //如果K7键按下，返回7
  49   1          else if(P1_7==0) return 8;  //如果K8键按下，返回8
  50   1      
  51   1          P1=0xFB;                    //将第三行置零，以扫描K9-K12是否被按下
  52   1          if(P1_4==0) return 9;       //如果K9键按下，返回9
  53   1          else if(P1_5==0) return 10;  //如果K10键按下，返回10
  54   1          else if(P1_6==0) return 11;  //如果K11键按下，返回11
  55   1          else if(P1_7==0) return 12;  //如果K12键按下，返回12
C51 COMPILER V7.00  TEST87                                                                 09/25/2013 10:43:29 PAGE 2   

  56   1      
  57   1          P1=0xF7;                    //将第四行置零，以扫描K13-K16是否被按下
  58   1          if(P1_4==0) return 13;      //如果K13键按下，返回13
  59   1          else if(P1_5==0) return 14;  //如果K14键按下，返回14
  60   1          else if(P1_6==0) return 15;  //如果K15键按下，返回15
  61   1          else if(P1_7==0) return 16;  //如果K16键按下，返回16
  62   1      
  63   1               return 0;                    //如果无按键按下，返回0
  64   1      }
  65          //---------------------------------------
  66          //名称: 蜂鸣器函数
  67          //适用：给力者GL9单片机开发学习系统
  68          //公司：宁波芯动电子有限公司
  69          //网址：www.MovingChip.com
  70          //日期：20130924
  71          //---------------------------------------
  72          void BeepPro(void)
  73          {
  74   1              if(Beepbit==1)                  //如果蜂鸣器已经发声
  75   1              {
  76   2                      if(BeepTwobit==0) P3_3=0;
  77   2                      BeepCon++;
  78   2                      if(BeepTwobit==1)
  79   2                      {
  80   3                              if(BeepCon<80)
  81   3                              {
  82   4                                      P3_3=0;
  83   4                              }
  84   3                              else if(BeepCon<160)
  85   3                              {
  86   4                                      P3_3=1;
  87   4                              }
  88   3                              else
  89   3                              {
  90   4                                      P3_3=0;
  91   4                              }
  92   3                      }
  93   2                      if(BeepCon>250)         //那么开始计数
  94   2                      {
  95   3                              BeepCon=0;              //计数到达设定值后清除计数      
  96   3                              Beepbit=0;
  97   3                      }       
  98   2              }
  99   1              else                          //如果蜂鸣器没发声
 100   1              {
 101   2                      P3_3=1;
 102   2                      BeepCon=0;                 //那么要给计数清零
 103   2                      BeepTwobit=0;
 104   2              }
 105   1      }
 106          //---------------------------------------
 107          //名称: 主函数
 108          //适用：给力者GL9单片机开发学习系统
 109          //公司：宁波芯动电子有限公司
 110          //网址：www.MovingChip.com
 111          //日期：20130924
 112          //---------------------------------------
 113          void main(void)            //主函数,单片机开机后就是从这个函数开始运行
 114          {    
 115   1              unsigned char k; 
 116   1              unsigned char d;
 117   1              unsigned char c;
C51 COMPILER V7.00  TEST87                                                                 09/25/2013 10:43:29 PAGE 3   

 118   1              unsigned int k5con;
 119   1              unsigned int f=0;
 120   1              unsigned int keycon;
 121   1              bit keybit;
 122   1      
 123   1              f=0;
 124   1         while(1)               //死循环,单片机初始化后,将一直运行这个死循环
 125   1         {
 126   2                      k=ScanKey();
 127   2                      if(k==0)                //如果无键按下
 128   2                      {
 129   3                              k5con=0;
 130   3                              if(keybit==0)
 131   3                              {
 132   4                                      if(++keycon>50) //消除抖动参数，越大消抖效果越好，但是按键越不灵敏
 133   4                                      {
 134   5                                              keycon=0;
 135   5                                              keybit=1;
 136   5                                      }
 137   4                              }
 138   3                              else
 139   3                                      keycon=0;                       
 140   3                      }          
 141   2                      else if(k==1)           //如果K1键按下,每次加1
 142   2                      {
 143   3                              if(keybit==1)   //如果标志位有效，说明这个是有效按键
 144   3                              {
 145   4                                      keybit=0;               //清除标志位，以保证每次按键只处理一次  
 146   4                                 Beepbit=1;
 147   4                                      if(f<9999) 
 148   4                                      {
 149   5                                              f++;                            
 150   5                                      }
 151   4                                      else
 152   4                                      {
 153   5                                              BeepTwobit=1;
 154   5                                      }
 155   4                              }
 156   3                 }                    
 157   2                      else if(k==2)           //如果K2键按下,每次减1
 158   2                      {
 159   3                              if(keybit==1)   //如果标志位有效，说明这个是有效按键
 160   3                              {
 161   4                                      keybit=0;               //清除标志位，以保证每次按键只处理一次
 162   4                                      Beepbit=1;
 163   4                                      if(f>0) 
 164   4                                      {
 165   5                                              f--;                                    
 166   5                                      }
 167   4                                      else
 168   4                                      {
 169   5                                              BeepTwobit=1;
 170   5                                      }
 171   4                              }
 172   3                 }
 173   2                      else if(k==5)           //如果K5键按下,连续加
 174   2                      {
 175   3                              if(keybit==1)   //如果标志位有效，说明这个是有效按键
 176   3                              {                               
 177   4                                      if(++k5con>750)
 178   4                                      {
 179   5                                              k5con=0;
C51 COMPILER V7.00  TEST87                                                                 09/25/2013 10:43:29 PAGE 4   

 180   5                                              Beepbit=1;
 181   5                                              if(f<9999) 
 182   5                                              {
 183   6                                                      f++;                                    
 184   6                                              }
 185   5                                              else
 186   5                                              {
 187   6                                                      BeepTwobit=1;
 188   6                                              }
 189   5                                      }
 190   4                              }
 191   3                 }
 192   2                      else if(k==6)           //如果K6键按下,连续减
 193   2                      {
 194   3                              if(keybit==1)   //如果标志位有效，说明这个是有效按键
 195   3                              {                               
 196   4                                      if(++k5con>750)
 197   4                                      {
 198   5                                              k5con=0;
 199   5                                              Beepbit=1;
 200   5                                              if(f>0) 
 201   5                                              {
 202   6                                                      f--;                                            
 203   6                                              }
 204   5                                              else
 205   5                                              {
 206   6                                                      BeepTwobit=1;
 207   6                                              }
 208   5                                      }
 209   4                              }
 210   3                 }
 211   2                      BeepPro();
 212   2                      for(c=0;c<250;c++);//做一个0-250的循环，不执行其他操作，只为延时
 213   2            
 214   2            P2=0;              //关一次显示，以免显示出鬼影
 215   2            if(++d>3) d=0;     //先将d加1，然后判断是否大于3，大于3归零
 216   2            if(d==0)           //如果d=0,显示千位
 217   2            {
 218   3                P0=0x03;       //U16A0=1,U16A1=1,U16A2=0选通数码管的千位进行显示
 219   3                P2=LED[f/1000];//将要显示的f的千位提取出来查表后送显示 
 220   3            }
 221   2            else if(d==1)      //如果d=1,显示百位
 222   2            {
 223   3                P0=0x02;       //U16A0=0,U16A1=1,U16A2=0选通数码管的百位进行显示
 224   3                P2=LED[(f%1000)/100];    //将要显示的f的百位提取出来查表后送显示
 225   3            }
 226   2            else if(d==2)      //如果d=2,显示十位
 227   2            {
 228   3                P0=0x01;       //U16A0=1,U16A1=0,U16A2=0选通数码管的十位进行显示
 229   3                P2=LED[(f%100)/10];      //将要显示的f的十位提取出来查表后送显示
 230   3            }
 231   2            else               //如果d=3,显示个位
 232   2            {
 233   3                P0=0x00;       //U16A0=0,U16A1=0,U16A2=0选通数码管的个位进行显示
 234   3                P2=LED[f%10];            //将要显示的f的个位提取出来查表后送显示
 235   3            }
 236   2         }
 237   1      }
 238          


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V7.00  TEST87                                                                 09/25/2013 10:43:29 PAGE 5   

   CODE SIZE        =    536    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
