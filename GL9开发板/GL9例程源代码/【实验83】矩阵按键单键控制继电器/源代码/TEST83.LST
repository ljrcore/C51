C51 COMPILER V7.00  TEST83                                                                 09/25/2013 08:55:34 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST83
OBJECT MODULE PLACED IN TEST83.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST83.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          //---------------------------------------
  11          //名称: 按键扫描函数
  12          //适用：给力者GL9单片机开发学习系统
  13          //公司：宁波芯动电子有限公司
  14          //网址：www.MovingChip.com
  15          //日期：20130924
  16          //---------------------------------------
  17          unsigned char ScanKey(void)
  18          {
  19   1              //***4×4矩阵按键扫描部分***
  20   1          //按K1-P16键，返回参数1-16
  21   1              P1=0xFE;                        //将第一行置零，以扫描K1-K4是否被按下
  22   1          if(P1_4==0) return 1;       //如果K1键按下，返回1
  23   1          else if(P1_5==0) return 2;  //如果K2键按下，返回2
  24   1          else if(P1_6==0) return 3;  //如果K3键按下，返回3
  25   1          else if(P1_7==0) return 4;  //如果K4键按下，返回4
  26   1      
  27   1          P1=0xFD;                    //将第二行置零，以扫描K5-K8是否被按下
  28   1          if(P1_4==0) return 5;       //如果K5键按下，返回5
  29   1          else if(P1_5==0) return 6;  //如果K6键按下，返回6
  30   1          else if(P1_6==0) return 7;  //如果K7键按下，返回7
  31   1          else if(P1_7==0) return 8;  //如果K8键按下，返回8
  32   1      
  33   1          P1=0xFB;                    //将第三行置零，以扫描K9-K12是否被按下
  34   1          if(P1_4==0) return 9;       //如果K9键按下，返回9
  35   1          else if(P1_5==0) return 10;  //如果K10键按下，返回10
  36   1          else if(P1_6==0) return 11;  //如果K11键按下，返回11
  37   1          else if(P1_7==0) return 12;  //如果K12键按下，返回12
  38   1      
  39   1          P1=0xF7;                    //将第四行置零，以扫描K13-K16是否被按下
  40   1          if(P1_4==0) return 13;      //如果K13键按下，返回13
  41   1          else if(P1_5==0) return 14;  //如果K14键按下，返回14
  42   1          else if(P1_6==0) return 15;  //如果K15键按下，返回15
  43   1          else if(P1_7==0) return 16;  //如果K16键按下，返回16
  44   1      
  45   1               return 0;                    //如果无按键按下，返回0
  46   1      }
  47          //---------------------------------------
  48          //名称: 主函数
  49          //适用：给力者GL9单片机开发学习系统
  50          //公司：宁波芯动电子有限公司
  51          //网址：www.MovingChip.com
  52          //日期：20130924
  53          //---------------------------------------
  54          void main(void)                 //主函数,单片机开机后就是从这个函数开始运行
  55          {    
C51 COMPILER V7.00  TEST83                                                                 09/25/2013 08:55:34 PAGE 2   

  56   1              unsigned char k;
  57   1              unsigned int keycon;
  58   1              bit keybit;
  59   1              P3_3=1;                 //按位方式写P1.3=1，保证继电器处于释放状态   
  60   1              while(1)                //死循环,单片机初始化后,将一直运行这个死循环
  61   1              {
  62   2                      k=ScanKey();
  63   2                      if(k==0)                //如果无键按下
  64   2                      {
  65   3                              if(keybit==0)
  66   3                              {
  67   4                                      if(++keycon>1000) //消除抖动参数，越大消抖效果越好，但是按键越不灵敏
  68   4                                      {
  69   5                                              keycon=0;
  70   5                                              keybit=1;
  71   5                                      }
  72   4                              }
  73   3                              else
  74   3                                      keycon=0;                       
  75   3                      }          
  76   2                      else if(k==1)           //如果K1键按下
  77   2                      {
  78   3                              if(keybit==1)   //如果标志位有效，说明这个是有效按键
  79   3                              {
  80   4                                      keybit=0;               //清除标志位，以保证每次按键只处理一次
  81   4                                      P3_3=~P3_3;             //继电器取反（乒乓开关）
  82   4                              }
  83   3                 }                    
  84   2         }
  85   1      }
  86          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
