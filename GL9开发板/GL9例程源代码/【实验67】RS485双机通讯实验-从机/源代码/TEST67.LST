C51 COMPILER V7.00  TEST67                                                                 02/28/2014 09:56:01 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST67
OBJECT MODULE PLACED IN TEST67.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST67.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          
  11          //---------------------------------------
  12          //1602液晶相关I/O设置
  13          sbit E=P2^3;               //1602液晶的E脚接在P2.3口上
  14          sbit RW=P2^4;              //1602液晶的RW脚接在P2.4口上
  15          sbit RS=P2^5;              //1602液晶的RS脚接在P2.5口上
  16          //---------------------------------------
  17          sbit RE_DE=P3^2;
  18          //---------------------------------------
  19          //串口接收寄存器设置
  20          unsigned char USARTbuf;    //设置8位的unsigend char型寄存器用来暂存串口接收内容
  21          //---------------------------------------
  22          
  23          //---------------------------------------
  24          //1602液晶寄存器设置
  25          unsigned char DISbuf;     //设置8位的unsigend char型寄存器用来暂存1602要显示的内容
  26          //---------------------------------------
  27          
  28          //---------------------------------------
  29          //名称：1602液晶用延时函数
  30          //适用：给力者GL9单片机开发学习系统
  31          //公司：宁波芯动电子有限公司
  32          //网址：www.MovingChip.com
  33          //日期：20120916
  34          //---------------------------------------
  35          void Delay1602(unsigned int t)
  36          { 
  37   1           unsigned int k;      //定义一个16位寄存器用来做延时用 
  38   1           for(k=0;k<t;k++);    //延时 
  39   1      } 
  40          
  41          //---------------------------------------
  42          //名称：1602液晶忙检测函数
  43          //适用：给力者GL9单片机开发学习系统
  44          //公司：宁波芯动电子有限公司
  45          //网址：www.MovingChip.com
  46          //日期：20120916
  47          //---------------------------------------
  48          void LCD1602_busy(void)
  49          { 
  50   1           P0_7=1;              //将P0.7置1，为读状态做准备 
  51   1           RS=0;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  52   1           RW=1;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  53   1           E=1;                 //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  54   1           while(P0_7==1);      //由P0.7读入1，表示1602液晶忙，需要等待
  55   1           E=0;                 //读完以后，恢复E的电平
C51 COMPILER V7.00  TEST67                                                                 02/28/2014 09:56:01 PAGE 2   

  56   1      } 
  57          
  58          //---------------------------------------
  59          //名称：1600写命令函数
  60          //适用：给力者GL9单片机开发学习系统
  61          //公司：宁波芯动电子有限公司
  62          //网址：www.MovingChip.com
  63          //日期：20120916
  64          //---------------------------------------
  65          void LCD1602_Write_com(unsigned char combuf)
  66          { 
  67   1           RS=0;                //选择指令寄存器
  68   1           RW=0;                //选择写状态
  69   1           P0=combuf;           //将命令字通过P0口送至DB
  70   1           E=1;                 //E高电平将命令字写入1602液晶
  71   1           E=0;                 //写完以后，恢复E的电平
  72   1      } 
  73          
  74          //---------------------------------------
  75          //名称：1602写命令函数(带忙检测)
  76          //适用：给力者GL9单片机开发学习系统
  77          //公司：宁波芯动电子有限公司
  78          //网址：www.MovingChip.com
  79          //日期：20120916
  80          //---------------------------------------
  81          void LCD1602_Write_com_busy(unsigned char combuf)
  82          { 
  83   1           LCD1602_busy();            //调用忙检测函数
  84   1           LCD1602_Write_com(combuf); //调用忙检测函数
  85   1      } 
  86          
  87          //---------------------------------------
  88          //名称：1602写数据函数(带忙检测)
  89          //适用：给力者GL9单片机开发学习系统
  90          //公司：宁波芯动电子有限公司
  91          //网址：www.MovingChip.com
  92          //日期：20120916
  93          //---------------------------------------
  94          void LCD1602_Write_data_busy(unsigned char databuf)
  95          { 
  96   1           LCD1602_busy();      //调用忙检测函数
  97   1           RS=1;                //选择数据寄存器
  98   1           RW=0;                //选择写状态
  99   1           P0=databuf;          //将命令字通过P0口送至DB
 100   1           E=1;                 //E高电平将命令字写入1602液晶
 101   1           E=0;                 //写完以后，恢复E的电平
 102   1      } 
 103          
 104          //---------------------------------------
 105          //名称：1602液晶显示地址写函数
 106          //适用：给力者GL9单片机开发学习系统
 107          //公司：宁波芯动电子有限公司
 108          //网址：www.MovingChip.com
 109          //日期：20120916
 110          //---------------------------------------
 111          void LCD1602_Write_address(unsigned char x,unsigned char y)
 112          { 
 113   1           x&=0x0f;             //列地址限制在0-15间
 114   1           y&=0x01;             //行地址限制在0-1间
 115   1           if(y==0)             //如果是第一行
 116   1               LCD1602_Write_com_busy(x|0x80);        //将列地址写入
 117   1           else                 //如果是第二行
C51 COMPILER V7.00  TEST67                                                                 02/28/2014 09:56:01 PAGE 3   

 118   1               LCD1602_Write_com_busy((x+0x40)|0x80); //将列地址写入
 119   1      } 
 120          
 121          //---------------------------------------
 122          //名称：1602液晶初始化函数
 123          //适用：给力者GL9单片机开发学习系统
 124          //公司：宁波芯动电子有限公司
 125          //网址：www.MovingChip.com
 126          //日期：20120916
 127          //---------------------------------------
 128          void LCD1602_init(void)
 129          { 
 130   1           Delay1602(1500);               //调用延时函数
 131   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 132   1           Delay1602(500);                //调用延时函数
 133   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 134   1           Delay1602(500);                //调用延时函数
 135   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 136   1           LCD1602_Write_com_busy(0x38);  //8位数据总线，两行显示模式，5*7点阵显示
 137   1           LCD1602_Write_com_busy(0x08);  //显示功能关，无光标
 138   1           LCD1602_Write_com_busy(0x01);  //清屏
 139   1           LCD1602_Write_com_busy(0x06);  //写入新的数据后，光标右移，显示屏不移动
 140   1           LCD1602_Write_com_busy(0x0C);  //显示功能开，无光标
 141   1      } 
 142          
 143          //---------------------------------------
 144          //名称：1602液晶指定地址显示函数
 145          //适用：给力者GL9单片机开发学习系统
 146          //公司：宁波芯动电子有限公司
 147          //网址：www.MovingChip.com
 148          //日期：20120916
 149          //---------------------------------------
 150          void LCD1602_Disp(unsigned char x,unsigned char y,unsigned char buf)
 151          { 
 152   1           LCD1602_Write_address(x,y);    //先将地址信息写入
 153   1           LCD1602_Write_data_busy(buf);  //再写入要显示的数据
 154   1      } 
 155          
 156          //---------------------------------------
 157          //名称: 主函数
 158          //适用：给力者GL9单片机开发学习系统
 159          //公司：宁波芯动电子有限公司
 160          //网址：www.MovingChip.com
 161          //日期：20120916
 162          //---------------------------------------
 163          void main(void)            //主函数,单片机开机后就是从这个函数开始运行
 164          {
 165   1      
 166   1          LCD1602_init();        //调用1602液晶初始化函数
 167   1      
 168   1          //*****USART串口初始化*****
 169   1          TMOD&=0x0F;            //把TMOD高4位清0
 170   1          TMOD|=0x20;            //将TMOD的M1位置1，设置成自动装入的8位定时器
 171   1          TH1=0xFA;              //设置波特率为9600
 172   1          TL1=0xFA;              //设置波特率为9600
 173   1          TR1=1;                 //启动定时器T1，作为串口波特率发生器
 174   1          SCON=0x50;             //10位异步收发，波特率由定时器控制，允许串口接收
 175   1          ES=0;                  //禁止串口中断
 176   1          //**************************
 177   1              RE_DE=0;                           //使MAX485芯片的数据方向为接收方向
 178   1          while(1)               //死循环,单片机初始化后,将一直运行这个死循环
 179   1          {
C51 COMPILER V7.00  TEST67                                                                 02/28/2014 09:56:01 PAGE 4   

 180   2      
 181   2          //****查询式串口接收程序****
 182   2              if(RI==1)               //如果接收标志位为1，说明有数据接收完毕
 183   2              {                       //RCIF在寄存器被读出后自动清零
 184   3                  USARTbuf=SBUF;      //将接收缓冲区内容转至USARTbuf寄存器中
 185   3                  RI=0;               //清除接收标志位
 186   3              }
 187   2          //**************************
 188   2      
 189   2          //**给1602显示寄存器赋值(0-255)**
 190   2              DISbuf=USARTbuf;            //
 191   2          //*******************************
 192   2      
 193   2          //***1602液晶显示0-255***
 194   2              LCD1602_Disp(0,0,DISbuf/100+'0');      //在第1行的第1列显示百位
 195   2              LCD1602_Disp(1,0,(DISbuf%100)/10+'0'); //在第1行的第2列显示十位
 196   2              LCD1602_Disp(2,0,DISbuf%10+'0');       //在第1行的第3列显示个位
 197   2          //***********************
 198   2      
 199   2          }
 200   1      }
 201          
 202          
 203          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    236    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
