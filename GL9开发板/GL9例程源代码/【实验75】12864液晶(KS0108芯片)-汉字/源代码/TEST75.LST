C51 COMPILER V7.00  TEST75                                                                 09/18/2012 22:08:39 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST75
OBJECT MODULE PLACED IN TEST75.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST75.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          #include <Intrins.h>    //因为本例中用到空操作_nop_();所以必须调用这个头文件
  11          
  12          //---------------------------------------
  13          //12864液晶相关I/O设置
  14          sbit RS=P2^0;                   //寄存器选择端 H:数据寄存器，L:命令寄存器
  15          sbit RW=P2^1;                   //读/写选择信号，R/W=1：读选通，R/W=0：写选通
  16          sbit E =P2^2;                   //读写使能信号，在E下降沿，数据被锁存(写)入,在E高电平器件，数据被读出
  17          sbit CS1=P2^3;                  //前64点选择，1有效
  18          sbit CS2=P2^4;                  //后64点选择，1有效
  19          sbit RST=P2^5;                  //复位信号
  20          sbit DB0=P0^7;                  //
  21          sbit DB1=P0^6;                  //
  22          sbit DB2=P0^5;                  //
  23          sbit DB3=P0^4;                  //
  24          sbit DB4=P0^3;                  //
  25          sbit DB5=P0^2;                  //
  26          sbit DB6=P0^1;                  //
  27          sbit DB7=P0^0;                  //
  28          //---------------------------------------
  29          
  30          //因为液晶无字库，汉字的字形需要用软件做出
  31          unsigned char code hzk[]={
  32          /*--  文字:  宁  --*/
  33          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  34          0x00,0x90,0x8C,0x84,0x84,0x84,0x85,0x86,0x84,0x84,0x84,0x84,0x94,0x8E,0x04,0x00,
  35          0x00,0x00,0x00,0x00,0x00,0x40,0x80,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  36          
  37          /*--  文字:  波  --*/
  38          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  39          0x10,0x60,0x01,0xE6,0x00,0xF8,0x88,0x88,0x88,0xFF,0x88,0x88,0x88,0x18,0x08,0x00,
  40          0x04,0x04,0xFF,0x40,0x30,0x8F,0x80,0x41,0x26,0x18,0x18,0x26,0x61,0xC0,0x40,0x00,
  41          
  42          /*--  文字:  芯  --*/
  43          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  44          0x00,0x04,0x04,0x04,0x84,0x1F,0x24,0xC4,0x84,0x04,0x1F,0x84,0x04,0x04,0x04,0x00,
  45          0x10,0x0E,0x00,0x00,0x3F,0x40,0x40,0x40,0x43,0x40,0x40,0x78,0x21,0x0E,0x04,0x00,
  46          
  47          /*--  文字:  动  --*/
  48          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  49          0x20,0x24,0x24,0xE4,0x24,0x24,0x24,0x20,0x10,0x10,0xFF,0x10,0x10,0xF0,0x00,0x00,
  50          0x08,0x1C,0x0B,0x08,0x0C,0x05,0x4E,0x24,0x10,0x0C,0x03,0x20,0x40,0x3F,0x00,0x00,
  51          
  52          /*--  文字:  电  --*/
  53          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  54          0x00,0x00,0xF8,0x48,0x48,0x48,0x48,0xFF,0x48,0x48,0x48,0x48,0xF8,0x00,0x00,0x00,
  55          0x00,0x00,0x0F,0x04,0x04,0x04,0x04,0x3F,0x44,0x44,0x44,0x44,0x4F,0x40,0x70,0x00,
C51 COMPILER V7.00  TEST75                                                                 09/18/2012 22:08:39 PAGE 2   

  56          
  57          /*--  文字:  子  --*/
  58          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  59          0x00,0x00,0x02,0x02,0x02,0x02,0x02,0xE2,0x12,0x0A,0x06,0x02,0x00,0x80,0x00,0x00,
  60          0x01,0x01,0x01,0x01,0x01,0x41,0x81,0x7F,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,
  61          
  62          /*--  文字:  有  --*/
  63          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  64          0x00,0x04,0x84,0x44,0xE4,0x34,0x2C,0x27,0x24,0x24,0x24,0xE4,0x04,0x04,0x04,0x00,
  65          0x02,0x01,0x00,0x00,0xFF,0x09,0x09,0x09,0x29,0x49,0xC9,0x7F,0x00,0x00,0x00,0x00,
  66          
  67          /*--  文字:  限  --*/
  68          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  69          0xFE,0x02,0x32,0x4E,0x82,0x00,0xFE,0x4A,0xCA,0x4A,0x4A,0x4A,0x7E,0x00,0x00,0x00,
  70          0xFF,0x00,0x02,0x04,0x03,0x00,0xFF,0x40,0x20,0x03,0x0C,0x12,0x21,0x60,0x20,0x00,
  71          
  72          /*--  文字:  公  --*/
  73          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  74          0x00,0x00,0x80,0x40,0x30,0x0E,0x84,0x00,0x00,0x0E,0x10,0x60,0xC0,0x80,0x80,0x00,
  75          0x00,0x01,0x20,0x70,0x28,0x24,0x23,0x31,0x10,0x10,0x14,0x78,0x30,0x01,0x00,0x00,
  76          
  77          /*--  文字:  司  --*/
  78          /*--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --*/
  79          0x00,0x10,0x92,0x92,0x92,0x92,0x92,0x92,0x92,0x92,0x12,0x02,0x02,0xFE,0x00,0x00,
  80          0x00,0x00,0x1F,0x04,0x04,0x04,0x04,0x04,0x04,0x0F,0x00,0x20,0x40,0x3F,0x00,0x00,
  81          
  82          };
  83          //---------------------------------------
  84          //名称：液晶用延时函数
  85          //适用：给力者GL9单片机开发学习系统
  86          //公司：宁波芯动电子有限公司
  87          //网址：www.MovingChip.com
  88          //日期：20120918
  89          //---------------------------------------
  90          void delay(unsigned int t)
  91          {
  92   1              unsigned int i;
  93   1              for(i=0;i<t;i++);       
  94   1      }
  95                  
  96          //---------------------------------------
  97          //名称：字节内位数据位置转换函数
  98          //适用：给力者GL9单片机开发学习系统
  99          //公司：宁波芯动电子有限公司
 100          //网址：www.MovingChip.com
 101          //日期：20120918
 102          //---------------------------------------
 103          unsigned char num(unsigned char dat)
 104          {
 105   1         unsigned char val;
 106   1              val = ((dat & 0x01) << 7) | ((dat & 0x02) << 5) | ((dat & 0x04) << 3) | ((dat & 0x08) << 1) |
 107   1         ((dat & 0x10) >> 1) | ((dat & 0x20) >> 3) | ((dat & 0x40) >> 5) | ((dat & 0x80) >> 7);
 108   1         return  val;
 109   1      } 
 110          //---------------------------------------
 111          //名称：写命令函数
 112          //适用：给力者GL9单片机开发学习系统
 113          //公司：宁波芯动电子有限公司
 114          //网址：www.MovingChip.com
 115          //日期：20120918
 116          //---------------------------------------
 117          void write_com(unsigned char cmdcode)
C51 COMPILER V7.00  TEST75                                                                 09/18/2012 22:08:39 PAGE 3   

 118          {                                          
 119   1              RS=0;                           //选择命令寄存器
 120   1              RW=0;                           //写选通
 121   1              P0=num(cmdcode);    //将命令写入总线
 122   1              _nop_();            //空操作，做短暂的延时
 123   1              E=1;                    //E的下降沿，数据写入
 124   1              _nop_();            //空操作，做短暂的延时
 125   1              E=0;                    //E的下降沿，数据写入
 126   1      }
 127          //---------------------------------------
 128          //名称：写数据函数
 129          //适用：给力者GL9单片机开发学习系统
 130          //公司：宁波芯动电子有限公司
 131          //网址：www.MovingChip.com
 132          //日期：20120918
 133          //---------------------------------------
 134          void write_data(unsigned char Rsspdata)
 135          {
 136   1      
 137   1              RS=1;                           //选择数据寄存器
 138   1              RW=0;                           //写选通
 139   1              P0=num(Rsspdata);   //将数据写入总线
 140   1              _nop_();            //空操作，做短暂的延时
 141   1              E=1;                    //E的下降沿，数据写入
 142   1              _nop_();            //空操作，做短暂的延时
 143   1              E=0;                    //E的下降沿，数据写入
 144   1      } 
 145          
 146          //---------------------------------------
 147          //名称：清屏函数
 148          //适用：给力者GL9单片机开发学习系统
 149          //公司：宁波芯动电子有限公司
 150          //网址：www.MovingChip.com
 151          //日期：20120918
 152          //---------------------------------------
 153          void Clr_Scr(void)
 154          {
 155   1              unsigned char j,k;
 156   1              CS1=1;                                                  //左半屏选通
 157   1              CS2=1;                                                  //右半屏选通
 158   1              write_com(0x40+0);         //将列地址写入  
 159   1                      //列地址格式为: 0 1 C5 C4 C3 C2 C1 C0,其中C5-C0=0~0x3f
 160   1                      //分别代表1~64列
 161   1              for(k=0;k<8;k++)
 162   1              {
 163   2                      write_com(0xb8+k);     //将行地址写入   
 164   2                      //行地址格式为: 1 0 1 1 1 P2 P1 P0,其中P3-C0=0~0x07
 165   2                      //分别代表1~8行
 166   2      
 167   2                      for(j=0;j<64;j++)               //每行的64列都写0，因为选了左右两屏，
 168   2                      {
 169   3                              write_data(0x00);       //64列同时写0
 170   3                      }
 171   2              }
 172   1      } 
 173                  
 174          //---------------------------------------
 175          //名称：地址写入函数
 176          //适用：给力者GL9单片机开发学习系统
 177          //公司：宁波芯动电子有限公司
 178          //网址：www.MovingChip.com
 179          //日期：20120918
C51 COMPILER V7.00  TEST75                                                                 09/18/2012 22:08:39 PAGE 4   

 180          //---------------------------------------
 181          void werite_x_y(unsigned char x,unsigned char y)
 182          {
 183   1              y=y&0x7f;                                 //限定范围，列不能超过128
 184   1              x=x&0x07;                                 //限定范围，行不能超过8
 185   1              if(y<64)                  //如果列小于64
 186   1              {
 187   2                      CS1=1;                 //选通左半屏
 188   2                      CS2=0;                 //关闭右半屏
 189   2                      write_com(0x40+y);     //将列地址写入  
 190   2                      //列地址格式为: 0 1 C5 C4 C3 C2 C1 C0,其中C5-C0=0~0x3f
 191   2                      //分别代表1~64列
 192   2              }
 193   1              else
 194   1              {
 195   2                      CS1=0;                 //关闭左半屏
 196   2                      CS2=1;                 //选通右半屏
 197   2                      y&=0x3f;
 198   2                      write_com(0x40+y);     //将列地址写入  
 199   2                      //列地址格式为: 0 1 C5 C4 C3 C2 C1 C0,其中C5-C0=0~0x3f
 200   2                      //分别代表1~64列        
 201   2              }
 202   1              write_com(0xb8+x);     //将行地址写入   
 203   1                      //行地址格式为: 1 0 1 1 1 P2 P1 P0,其中P3-C0=0~0x07
 204   1                      //分别代表1~8行
 205   1      } 
 206          
 207          //---------------------------------------
 208          //适用：指定位置写16*16汉字函数
 209          //公司：宁波芯动电子有限公司
 210          //网址：www.MovingChip.com
 211          //日期：20120918
 212          //---------------------------------------
 213          void write_chinese(unsigned char x,unsigned char y, unsigned char hz)
 214          {
 215   1              unsigned char i=0;      
 216   1              werite_x_y(x,y);          //设定起始地址
 217   1      
 218   1              //hz为索引，每个汉字占用32个字节，首地址为(hz-1)*32
 219   1              for(i=0;i<16;i++) write_data(hzk[hz*32+i]);//先写上半个字，共16个字节
 220   1              werite_x_y(x+1,y);        //设定起始地址，此次将行地址加1，以便写下行
 221   1              for(i=0;i<16;i++) write_data(hzk[hz*32+16+i]);  //再写下半个字，共16个字节
 222   1      }
 223          //---------------------------------------
 224          //名称：12864初始化函数
 225          //适用：给力者GL9单片机开发学习系统
 226          //公司：宁波芯动电子有限公司
 227          //网址：www.MovingChip.com
 228          //日期：20120918
 229          //--------------------------------------- 
 230          void init_lcd(void)
 231          {          
 232   1              RST=0;                 //液晶复位
 233   1              delay(250);            //适当延时
 234   1              RST=1;                 //复位结束
 235   1              CS1=1;                                    //左半屏选通
 236   1              CS2=1;                                    //右半屏选通  
 237   1              delay(250);            //适当延时
 238   1              write_com(0x3f);       //显示开
 239   1      }  
 240          //---------------------------------------
 241          //名称: 主函数
C51 COMPILER V7.00  TEST75                                                                 09/18/2012 22:08:39 PAGE 5   

 242          //适用：给力者GL9单片机开发学习系统
 243          //公司：宁波芯动电子有限公司
 244          //网址：www.MovingChip.com
 245          //日期：20120918
 246          //---------------------------------------       
 247          void main()
 248          {  
 249   1              init_lcd();                                       //初始化液晶
 250   1              Clr_Scr();                                        //清屏
 251   1      
 252   1              write_chinese(0,0,0);  //宁
 253   1              write_chinese(0,16,1);  //波
 254   1              write_chinese(0,32,2);  //芯
 255   1              write_chinese(0,48,3);  //动
 256   1         write_chinese(0,64,4);  //电
 257   1              write_chinese(0,80,5);  //子
 258   1              write_chinese(0,96,6);  //有
 259   1              write_chinese(0,112,7);  //限
 260   1              write_chinese(2,0,8);    //公
 261   1              write_chinese(2,16,9);  //司
 262   1              while(1)
 263   1              {                       
 264   2                      
 265   2              }
 266   1      }
 267          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    398    ----
   CONSTANT SIZE    =    320    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
