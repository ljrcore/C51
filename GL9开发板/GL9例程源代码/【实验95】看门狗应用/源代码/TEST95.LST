C51 COMPILER V7.00  TEST95                                                                 04/11/2014 09:51:27 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST95
OBJECT MODULE PLACED IN TEST95.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST95.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          
  11          //新增特殊功能寄存器定义
  12          sfr      WDT_CONTR      =   0xe1;
  13          //---------------------------------------
  14          //8独立按键相关I/O设置
  15          sbit P1key=P1^0;           //按键P1接在P1.0口上
  16          sbit P2key=P1^1;           //按键P2接在P1.1口上
  17          sbit P3key=P1^2;           //按键P3接在P1.2口上
  18          sbit P4key=P1^3;           //按键P4接在P1.3口上
  19          sbit P5key=P1^4;           //按键P5接在P1.4口上
  20          sbit P6key=P1^5;           //按键P6接在P1.5口上
  21          sbit P7key=P1^6;           //按键P7接在P1.6口上
  22          sbit P8key=P1^7;           //按键P8接在P1.7口上
  23          //---------------------------------------
  24          
  25          //---------------------------------------
  26          //1602液晶相关I/O设置
  27          sbit E=P2^3;               //1602液晶的E脚接在P2.3口上
  28          sbit RW=P2^4;              //1602液晶的RW脚接在P2.4口上
  29          sbit RS=P2^5;              //1602液晶的RS脚接在P2.5口上
  30          //---------------------------------------
  31          
  32          //---------------------------------------
  33          //名称：1602液晶用延时函数
  34          //适用：给力者GL9单片机开发学习系统
  35          //公司：宁波芯动电子有限公司
  36          //网址：www.MovingChip.com
  37          //日期：20140411
  38          //---------------------------------------
  39          void Delay1602(unsigned int t)
  40          { 
  41   1           unsigned int k;      //定义一个16位寄存器用来做延时用 
  42   1           for(k=0;k<t;k++);    //延时 
  43   1      } 
  44          
  45          //---------------------------------------
  46          //名称：1602液晶忙检测函数
  47          //适用：给力者GL9单片机开发学习系统
  48          //公司：宁波芯动电子有限公司
  49          //网址：www.MovingChip.com
  50          //日期：20140411
  51          //---------------------------------------
  52          void LCD1602_busy(void)
  53          { 
  54   1           P0_7=1;              //将P0.7置1，为读状态做准备 
  55   1           RS=0;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
C51 COMPILER V7.00  TEST95                                                                 04/11/2014 09:51:27 PAGE 2   

  56   1           RW=1;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  57   1           E=1;                 //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  58   1           while(P0_7==1);      //由P0.7读入1，表示1602液晶忙，需要等待
  59   1           E=0;                 //读完以后，恢复E的电平
  60   1      } 
  61          
  62          //---------------------------------------
  63          //名称：1600写命令函数
  64          //适用：给力者GL9单片机开发学习系统
  65          //公司：宁波芯动电子有限公司
  66          //网址：www.MovingChip.com
  67          //日期：20140411
  68          //---------------------------------------
  69          void LCD1602_Write_com(unsigned char combuf)
  70          { 
  71   1           RS=0;                //选择指令寄存器
  72   1           RW=0;                //选择写状态
  73   1           P0=combuf;           //将命令字通过P0口送至DB
  74   1           E=1;                 //E高电平将命令字写入1602液晶
  75   1           E=0;                 //写完以后，恢复E的电平
  76   1      } 
  77          
  78          //---------------------------------------
  79          //名称：1602写命令函数(带忙检测)
  80          //适用：给力者GL9单片机开发学习系统
  81          //公司：宁波芯动电子有限公司
  82          //网址：www.MovingChip.com
  83          //日期：20140411
  84          //---------------------------------------
  85          void LCD1602_Write_com_busy(unsigned char combuf)
  86          { 
  87   1           LCD1602_busy();            //调用忙检测函数
  88   1           LCD1602_Write_com(combuf); //调用忙检测函数
  89   1      } 
  90          
  91          //---------------------------------------
  92          //名称：1602写数据函数(带忙检测)
  93          //适用：给力者GL9单片机开发学习系统
  94          //公司：宁波芯动电子有限公司
  95          //网址：www.MovingChip.com
  96          //日期：20140411
  97          //---------------------------------------
  98          void LCD1602_Write_data_busy(unsigned char databuf)
  99          { 
 100   1           LCD1602_busy();      //调用忙检测函数
 101   1           RS=1;                //选择数据寄存器
 102   1           RW=0;                //选择写状态
 103   1           P0=databuf;          //将命令字通过P0口送至DB
 104   1           E=1;                 //E高电平将命令字写入1602液晶
 105   1           E=0;                 //写完以后，恢复E的电平
 106   1      } 
 107          
 108          //---------------------------------------
 109          //名称：1602液晶显示地址写函数
 110          //适用：给力者GL9单片机开发学习系统
 111          //公司：宁波芯动电子有限公司
 112          //网址：www.MovingChip.com
 113          //日期：20140411
 114          //---------------------------------------
 115          void LCD1602_Write_address(unsigned char x,unsigned char y)
 116          { 
 117   1           x&=0x0f;             //列地址限制在0-15间
C51 COMPILER V7.00  TEST95                                                                 04/11/2014 09:51:27 PAGE 3   

 118   1           y&=0x01;             //行地址限制在0-1间
 119   1           if(y==0)             //如果是第一行
 120   1               LCD1602_Write_com_busy(x|0x80);        //将列地址写入
 121   1           else                 //如果是第二行
 122   1               LCD1602_Write_com_busy((x+0x40)|0x80); //将列地址写入
 123   1      } 
 124          
 125          //---------------------------------------
 126          //名称：1602液晶初始化函数
 127          //适用：给力者GL9单片机开发学习系统
 128          //公司：宁波芯动电子有限公司
 129          //网址：www.MovingChip.com
 130          //日期：20140411
 131          //---------------------------------------
 132          void LCD1602_init(void)
 133          { 
 134   1           Delay1602(1500);               //调用延时函数
 135   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 136   1           Delay1602(500);                //调用延时函数
 137   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 138   1           Delay1602(500);                //调用延时函数
 139   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 140   1           LCD1602_Write_com_busy(0x38);  //8位数据总线，两行显示模式，5*7点阵显示
 141   1           LCD1602_Write_com_busy(0x08);  //显示功能关，无光标
 142   1           LCD1602_Write_com_busy(0x01);  //清屏
 143   1           LCD1602_Write_com_busy(0x06);  //写入新的数据后，光标右移，显示屏不移动
 144   1           LCD1602_Write_com_busy(0x0C);  //显示功能开，无光标
 145   1      } 
 146          
 147          //---------------------------------------
 148          //名称：1602液晶指定地址显示函数
 149          //适用：给力者GL9单片机开发学习系统
 150          //公司：宁波芯动电子有限公司
 151          //网址：www.MovingChip.com
 152          //日期：20140411
 153          //---------------------------------------
 154          void LCD1602_Disp(unsigned char x,unsigned char y,unsigned char buf)
 155          { 
 156   1           LCD1602_Write_address(x,y);    //先将地址信息写入
 157   1           LCD1602_Write_data_busy(buf);  //再写入要显示的数据
 158   1      } 
 159          
 160          //---------------------------------------
 161          //名称: 主函数
 162          //适用：给力者GL9单片机开发学习系统
 163          //公司：宁波芯动电子有限公司
 164          //网址：www.MovingChip.com
 165          //日期：20140411
 166          //---------------------------------------
 167          void main(void)            //主函数,单片机开机后就是从这个函数开始运行
 168          {
 169   1          LCD1602_init();        //调用1602液晶初始化函数
 170   1              LCD1602_Disp(0,0,'B');      //在第1行的第1列显示B
 171   1          LCD1602_Disp(1,0,'o');      //在第1行的第2列显示o
 172   1              LCD1602_Disp(2,0,'o');      //在第1行的第3列显示o
 173   1              LCD1602_Disp(3,0,'t');      //在第1行的第4列显示t
 174   1              LCD1602_Disp(4,0,'i');      //在第1行的第5列显示i
 175   1              LCD1602_Disp(5,0,'n');      //在第1行的第6列显示n
 176   1              LCD1602_Disp(6,0,'g');      //在第1行的第7列显示g
 177   1              LCD1602_Disp(7,0,'.');      //在第1行的第8列显示.
 178   1              LCD1602_Disp(8,0,'.');      //在第1行的第9列显示.
 179   1              LCD1602_Disp(9,0,'.');      //在第1行的第10列显示.
C51 COMPILER V7.00  TEST95                                                                 04/11/2014 09:51:27 PAGE 4   

 180   1              WDT_CONTR=0x3f;   
 181   1              //12时钟模式，看门狗溢出时间=（12*Pre_scale*32768）/22118400
 182   1              //=Pre_scale*393216/22118400
 183   1              //设置为256分频，看门狗溢出时间为4.5511秒
 184   1          while(1)                            //死循环,单片机初始化后,将一直运行这个死循环
 185   1          {
 186   2                      WDT_CONTR=0x3f;         //在正常的路途中，设置喂狗程序
 187   2                      if(P1key==0)                    //如果P1键按下,人为制造一个死循环
 188   2                              {
 189   3                                      LCD1602_Disp(0,0,'C');      //在第1行的第1列显示C
 190   3                              LCD1602_Disp(1,0,'P');      //在第1行的第2列显示P
 191   3                                      LCD1602_Disp(2,0,'U');      //在第1行的第3列显示U
 192   3                                      LCD1602_Disp(3,0,' ');      //在第1行的第4列显示""
 193   3                                      LCD1602_Disp(4,0,'i');      //在第1行的第5列显示i
 194   3                                      LCD1602_Disp(5,0,'s');      //在第1行的第6列显示s
 195   3                                      LCD1602_Disp(6,0,' ');      //在第1行的第7列显示""
 196   3                                      LCD1602_Disp(7,0,'d');      //在第1行的第8列显示d
 197   3                                      LCD1602_Disp(8,0,'e');      //在第1行的第9列显示e
 198   3                                      LCD1602_Disp(9,0,'a');      //在第1行的第10列显示a
 199   3                                      LCD1602_Disp(10,0,'d');      //在第1行的第11列显示d
 200   3                                      while(1);                                       //程序运行到这将死在这里，逼迫看门狗起作用
 201   3                      }
 202   2          }
 203   1      }
 204          //实验说明：
 205          //插上1602液晶
 206          //插上8P杜邦线一条于CN6-CN32之间
 207          //按P1键将使CPU进入死循环,以观察看门狗是否起作用


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    325    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
