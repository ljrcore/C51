////////////////////////////////////////////////////////////////////////////
//                给力者单片机开发学习系统，开发学习都给力！              //
////////////////////////////////////////////////////////////////////////////
//                     学习51单片机，其实可以很简单                       //
////////////////////////////////////////////////////////////////////////////
//                宁波芯动电子有限公司  www.MovingChip.com                //
////////////////////////////////////////////////////////////////////////////

#include <AT89X52.h>       //调用51单片机的头文件

//---------------------------------------
//定义一个数据表格
unsigned char code TAB[10]=
{                          //定义表格一定要使用code，这样会做到程序存储区中
    0x3F,                  //表格第1步数据0b00111111
    0x06,                  //表格第2步数据0b00000110
    0x5B,                  //表格第3步数据0b01011011
    0x4F,                  //表格第4步数据0b01001111
    0x66,                  //表格第5步数据0b01100110
    0x6D,                  //表格第6步数据0b01101101
    0x7D,                  //表格第7步数据0b01111101
    0x07,                  //表格第8步数据0b00000111
    0x7F,                  //表格第9步数据0b01111111
    0x6F,                  //表格第10步数据0b01101111
};
unsigned int i;      //定义一个int型变量，中断计次用
unsigned char b=9;    //定义一个char型变量，显示内容用

//---------------------------------------
//名称：定时器2中断服务程序
//适用：给力者GL9单片机开发学习系统
//公司：宁波芯动电子有限公司
//网址：www.MovingChip.com
//日期：20120914
//---------------------------------------
void Timer2(void) interrupt 5 
{                          //定时25000微秒
    TF2=0;                 //溢出标志位必须软件清除
    TL2=0xFF;              //重新给TL2赋初值
    TH2=0x4B;              //重新给TH2赋初值

    //***此处用户自行添加定时器T2中断处理程序***
	if(++i>39)         //对中断计次，记到40次后，刚好1秒钟
	{
		i=0;            //对计次用寄存器清零，以被下一个计次循环
		if(++b>9) b=0;  //进行秒计数，因为数码管为1位，所以大于9后清零
		P2=TAB[b];          //将TAB[b]的值送入P1口输出
	}
    //******************************************

}
//---------------------------------------
//名称: 主函数
//适用：给力者GL9单片机开发学习系统
//公司：宁波芯动电子有限公司
//网址：www.MovingChip.com
//日期：20120914
//---------------------------------------
void main(void)            //主函数,单片机开机后就是从这个函数开始运行
{

     //***定时器Timer2初始化***
    TL2=0xFF;              //设置定时器2初值低8位
    TH2=0x4B;              //设置定时器2初值高8位
    TR2=1;                 //启动定时器2
    ET2=1;                 //Timer2中断允许
    //**********************

    //***开全局中断设置****
    //定时器Timer1设置了中断允许,此处要开全局中断
    //定时器Timer2设置了中断允许,此处要开全局中断
    EA=1;                  //开全局中断
    //*********************

    while(1)               //死循环,单片机初始化后,将一直运行这个死循环
    {     

    }
}



/*void Timer2() interrupt 5
{
	TF2=0;
 	RCAP2H=0x4b;
 	RCAP2L=0xff;			 //再次置初值，以使下一次中断仍然为25ms

 //中断服务代码添加在这里  
 	if(++i>39)         //对中断计次，记到40次后，刚好1秒钟
	{
		i=0;            //对计次用寄存器清零，以被下一个计次循环
		if(++k>9) k=0;  //进行秒计数，因为数码管为1位，所以大于9后清零
		P0=tab[k];      //要显示的数查后取显示数据送给P0口
	}
 //以上是中断服务代码                 
}
//---------------------------------------
//函数名称: 主函数	
//适用型号：给力者51&AVR单片机学习开发系统(GL8)
//公司名称：宁波芯动电子有限公司
//公司网址：www.MovingChip.com
//编写日期：20120608
//----------------------------------------- 		
void main()             //主函数，单片机启动后，从这个函数开始运行
{	
	P0=tab[0];          //开机后数码管显示0
 	RCAP2H=0x4b;
 	RCAP2L=0xff;			//RCAP2H与RCAP2L拼成了16位的计数寄存器 
            			//这里设置其初值为 0x4bff，变定时器2中断的触发周期约为25000us
            			//定时器启动后它以CPU频率自增至0xffff后触发中断
 	ET2=1;				//使能定时器2中断
 	EA=1;				   //使能全局中断(要使某中断真正使能，除了置位相应的中断使能位，还必须置位全局中断使能位)
 	TR2=1;     			//启动定时器2
	while(1)          //死循环，反复的执行里面的代码
	{
	  	 
	}
}*/

