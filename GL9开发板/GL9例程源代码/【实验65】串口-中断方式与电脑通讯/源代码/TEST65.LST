C51 COMPILER V7.00  TEST65                                                                 09/14/2012 22:53:53 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST65
OBJECT MODULE PLACED IN TEST65.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST65.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          
  11          //---------------------------------------
  12          //1602液晶相关I/O设置
  13          sbit E=P2^3;               //1602液晶的E脚接在P2.3口上
  14          sbit RW=P2^4;              //1602液晶的RW脚接在P2.4口上
  15          sbit RS=P2^5;              //1602液晶的RS脚接在P2.5口上
  16          //---------------------------------------
  17          
  18          //---------------------------------------
  19          //串口接收寄存器设置
  20          unsigned char USARTbuf;    //设置8位的unsigend char型寄存器用来暂存串口接收内容
  21          //---------------------------------------
  22          
  23          //---------------------------------------
  24          //1602液晶寄存器设置
  25          unsigned char DISbuf;     //设置8位的unsigend char型寄存器用来暂存1602要显示的内容
  26          unsigned char j;          //设置8位的unsigend char型寄存器用来暂存转换数据
  27          //---------------------------------------
  28          
  29          //---------------------------------------
  30          //名称：串口中断服务程序
  31          //适用：给力者GL9单片机开发学习系统
  32          //公司：宁波芯动电子有限公司
  33          //网址：www.MovingChip.com
  34          //日期：20120914
  35          //---------------------------------------
  36          void UART_SER (void) interrupt 4 
  37          {
  38   1          if(RI==1)              //如果接收标志位为1，说明有数据接收完毕
  39   1          {                      //RCIF在寄存器被读出后自动清零
  40   2              USARTbuf=SBUF;     //将接收缓冲区内容转至USARTbuf寄存器中
  41   2              RI=0;              //清除接收标志位
  42   2              SBUF=USARTbuf+1;   //将接收到的内容+1后发送出去
  43   2              while(!TI);        //一直等到数据发送完毕
  44   2          }
  45   1          if(TI) TI=0;           //如果是发送引起的中断，清零
  46   1      }
  47          
  48          //---------------------------------------
  49          //名称：1602液晶用延时函数
  50          //适用：给力者GL9单片机开发学习系统
  51          //公司：宁波芯动电子有限公司
  52          //网址：www.MovingChip.com
  53          //日期：20120914
  54          //---------------------------------------
  55          void Delay1602(unsigned int t)
C51 COMPILER V7.00  TEST65                                                                 09/14/2012 22:53:53 PAGE 2   

  56          { 
  57   1           unsigned int k;      //定义一个16位寄存器用来做延时用 
  58   1           for(k=0;k<t;k++);    //延时 
  59   1      } 
  60          
  61          //---------------------------------------
  62          //名称：1602液晶忙检测函数
  63          //适用：给力者GL9单片机开发学习系统
  64          //公司：宁波芯动电子有限公司
  65          //网址：www.MovingChip.com
  66          //日期：20120914
  67          //---------------------------------------
  68          void LCD1602_busy(void)
  69          { 
  70   1           P0_7=1;              //将P0.7置1，为读状态做准备 
  71   1           RS=0;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  72   1           RW=1;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  73   1           E=1;                 //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  74   1           while(P0_7==1);      //由P0.7读入1，表示1602液晶忙，需要等待
  75   1           E=0;                 //读完以后，恢复E的电平
  76   1      } 
  77          
  78          //---------------------------------------
  79          //名称：1600写命令函数
  80          //适用：给力者GL9单片机开发学习系统
  81          //公司：宁波芯动电子有限公司
  82          //网址：www.MovingChip.com
  83          //日期：20120914
  84          //---------------------------------------
  85          void LCD1602_Write_com(unsigned char combuf)
  86          { 
  87   1           RS=0;                //选择指令寄存器
  88   1           RW=0;                //选择写状态
  89   1           P0=combuf;           //将命令字通过P0口送至DB
  90   1           E=1;                 //E高电平将命令字写入1602液晶
  91   1           E=0;                 //写完以后，恢复E的电平
  92   1      } 
  93          
  94          //---------------------------------------
  95          //名称：1602写命令函数(带忙检测)
  96          //适用：给力者GL9单片机开发学习系统
  97          //公司：宁波芯动电子有限公司
  98          //网址：www.MovingChip.com
  99          //日期：20120914
 100          //---------------------------------------
 101          void LCD1602_Write_com_busy(unsigned char combuf)
 102          { 
 103   1           LCD1602_busy();            //调用忙检测函数
 104   1           LCD1602_Write_com(combuf); //调用忙检测函数
 105   1      } 
 106          
 107          //---------------------------------------
 108          //名称：1602写数据函数(带忙检测)
 109          //适用：给力者GL9单片机开发学习系统
 110          //公司：宁波芯动电子有限公司
 111          //网址：www.MovingChip.com
 112          //日期：20120914
 113          //---------------------------------------
 114          void LCD1602_Write_data_busy(unsigned char databuf)
 115          { 
 116   1           LCD1602_busy();      //调用忙检测函数
 117   1           RS=1;                //选择数据寄存器
C51 COMPILER V7.00  TEST65                                                                 09/14/2012 22:53:53 PAGE 3   

 118   1           RW=0;                //选择写状态
 119   1           P0=databuf;          //将命令字通过P0口送至DB
 120   1           E=1;                 //E高电平将命令字写入1602液晶
 121   1           E=0;                 //写完以后，恢复E的电平
 122   1      } 
 123          
 124          //---------------------------------------
 125          //名称：1602液晶显示地址写函数
 126          //适用：给力者GL9单片机开发学习系统
 127          //公司：宁波芯动电子有限公司
 128          //网址：www.MovingChip.com
 129          //日期：20120914
 130          //---------------------------------------
 131          void LCD1602_Write_address(unsigned char x,unsigned char y)
 132          { 
 133   1           x&=0x0f;             //列地址限制在0-15间
 134   1           y&=0x01;             //行地址限制在0-1间
 135   1           if(y==0)             //如果是第一行
 136   1               LCD1602_Write_com_busy(x|0x80);        //将列地址写入
 137   1           else                 //如果是第二行
 138   1               LCD1602_Write_com_busy((x+0x40)|0x80); //将列地址写入
 139   1      } 
 140          
 141          //---------------------------------------
 142          //名称：1602液晶初始化函数
 143          //适用：给力者GL9单片机开发学习系统
 144          //公司：宁波芯动电子有限公司
 145          //网址：www.MovingChip.com
 146          //日期：20120914
 147          //---------------------------------------
 148          void LCD1602_init(void)
 149          { 
 150   1           Delay1602(1500);               //调用延时函数
 151   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 152   1           Delay1602(500);                //调用延时函数
 153   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 154   1           Delay1602(500);                //调用延时函数
 155   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 156   1           LCD1602_Write_com_busy(0x38);  //8位数据总线，两行显示模式，5*7点阵显示
 157   1           LCD1602_Write_com_busy(0x08);  //显示功能关，无光标
 158   1           LCD1602_Write_com_busy(0x01);  //清屏
 159   1           LCD1602_Write_com_busy(0x06);  //写入新的数据后，光标右移，显示屏不移动
 160   1           LCD1602_Write_com_busy(0x0C);  //显示功能开，无光标
 161   1      } 
 162          
 163          //---------------------------------------
 164          //名称：1602液晶指定地址显示函数
 165          //适用：给力者GL9单片机开发学习系统
 166          //公司：宁波芯动电子有限公司
 167          //网址：www.MovingChip.com
 168          //日期：20120914
 169          //---------------------------------------
 170          void LCD1602_Disp(unsigned char x,unsigned char y,unsigned char buf)
 171          { 
 172   1           LCD1602_Write_address(x,y);    //先将地址信息写入
 173   1           LCD1602_Write_data_busy(buf);  //再写入要显示的数据
 174   1      } 
 175          
 176          //---------------------------------------
 177          //名称: 主函数
 178          //适用：给力者GL9单片机开发学习系统
 179          //公司：宁波芯动电子有限公司
C51 COMPILER V7.00  TEST65                                                                 09/14/2012 22:53:53 PAGE 4   

 180          //网址：www.MovingChip.com
 181          //日期：20120914
 182          //---------------------------------------
 183          void main(void)            //主函数,单片机开机后就是从这个函数开始运行
 184          {
 185   1      
 186   1          LCD1602_init();        //调用1602液晶初始化函数
 187   1      
 188   1          //*****USART串口初始化*****
 189   1          TMOD&=0x0F;            //把TMOD高4位清0
 190   1          TMOD|=0x20;            //将TMOD的M1位置1，设置成自动装入的8位定时器
 191   1          TH1=0xFA;              //设置波特率为9600
 192   1          TL1=0xFA;              //设置波特率为9600
 193   1          TR1=1;                 //启动定时器T1，作为串口波特率发生器
 194   1          SCON=0x50;             //10位异步收发，波特率由定时器控制，允许串口接收
 195   1          ES=1;                  //允许串口中断
 196   1          //**************************
 197   1      
 198   1          //***开全局中断设置****
 199   1          //串口接口UART设置了中断允许,此处要开全局中断
 200   1          EA=1;                  //开全局中断
 201   1          //*********************
 202   1      
 203   1          while(1)               //死循环,单片机初始化后,将一直运行这个死循环
 204   1          {
 205   2      
 206   2          //**给1602显示寄存器赋值(0x00-0xFF)**
 207   2              DISbuf=USARTbuf;           //
 208   2          //***********************************
 209   2      
 210   2          //***1602液晶显示0x00-0xFF***
 211   2              LCD1602_Disp(0,0,'0');      //在第1行的第1列显示0
 212   2              LCD1602_Disp(1,0,'x');      //在第1行的第2列显示x
 213   2              j=DISbuf>>4;                //把要显示内容的高4位移到低4位上
 214   2              if(j<10)                    //0-F在ASCII码中并不连续，所以要分开处理
 215   2              {
 216   3                  j+='0';                 //0-9的数据以0为基点进行偏移即可
 217   3              }
 218   2              else
 219   2              {
 220   3                  j=j-10+'A';             //A-F的数据以A为基点进行偏移即可
 221   3              }
 222   2              LCD1602_Disp(2,0,j);        //在第1行的第3列显示高4位的十六进制数字
 223   2              j=DISbuf&0x0F;              //把要显示内容的高4位屏蔽掉，保留低4位
 224   2              if(j<10)                    //0-F在ASCII码中并不连续，所以要分开处理
 225   2              {
 226   3                  j+='0';                 //0-9的数据以0为基点进行偏移即可
 227   3              }
 228   2              else
 229   2              {
 230   3                  j=j-10+'A';             //A-F的数据以A为基点进行偏移即可
 231   3              }
 232   2              LCD1602_Disp(3,0,j);        //在第1行的第4列显示低4位的十六进制数字
 233   2          //***********************
 234   2      
 235   2          }
 236   1      }
 237          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    285    ----
C51 COMPILER V7.00  TEST65                                                                 09/14/2012 22:53:53 PAGE 5   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
