C51 COMPILER V7.00  TEST43                                                                 09/19/2012 10:30:32 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST43
OBJECT MODULE PLACED IN TEST43.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST43.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          
  11          //---------------------------------------
  12          //1602液晶相关I/O设置
  13          sbit E=P2^3;               //1602液晶的E脚接在P2.3口上
  14          sbit RW=P2^4;              //1602液晶的RW脚接在P2.4口上
  15          sbit RS=P2^5;              //1602液晶的RS脚接在P2.5口上
  16          //---------------------------------------
  17          unsigned char i;
  18          //---------------------------------------
  19          //1602液晶寄存器设置
  20          unsigned int  DISbuf;     //设置16位的unsigend int型寄存器用来暂存1602要显示的内容
  21          //---------------------------------------
  22          
  23          //---------------------------------------
  24          //名称：定时器0中断服务程序
  25          //适用：给力者GL9单片机开发学习系统
  26          //公司：宁波芯动电子有限公司
  27          //网址：www.MovingChip.com
  28          //日期：20120914
  29          //---------------------------------------
  30          void Timer0(void) interrupt 1 
  31          {                          //定时25000微秒
  32   1          TL0=0xFF;              //重新给TL0赋初值
  33   1          TH0=0x4B;              //重新给TH0赋初值
  34   1      
  35   1          //***此处用户自行添加定时器T0中断处理程序***
  36   1              if(++i>39)         //对中断计次，记到40次后，刚好1秒钟
  37   1              {
  38   2                      i=0;            //对计次用寄存器清零，以被下一个计次循环
  39   2                      //**给1602显示寄存器赋值(0-9999)**
  40   2              if(++DISbuf>9999) DISbuf=0;    
  41   2          //********************************
  42   2              }
  43   1          //******************************************
  44   1      
  45   1      }
  46          //---------------------------------------
  47          //名称：1602液晶用延时函数
  48          //适用：给力者GL9单片机开发学习系统
  49          //公司：宁波芯动电子有限公司
  50          //网址：www.MovingChip.com
  51          //日期：20120914
  52          //---------------------------------------
  53          void Delay1602(unsigned int t)
  54          { 
  55   1           unsigned int k;      //定义一个16位寄存器用来做延时用 
C51 COMPILER V7.00  TEST43                                                                 09/19/2012 10:30:32 PAGE 2   

  56   1           for(k=0;k<t;k++);    //延时 
  57   1      } 
  58          
  59          //---------------------------------------
  60          //名称：1602液晶忙检测函数
  61          //适用：给力者GL9单片机开发学习系统
  62          //公司：宁波芯动电子有限公司
  63          //网址：www.MovingChip.com
  64          //日期：20120914
  65          //---------------------------------------
  66          void LCD1602_busy(void)
  67          { 
  68   1           P0_7=1;              //将P0.7置1，为读状态做准备 
  69   1           RS=0;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  70   1           RW=1;                //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  71   1           E=1;                 //RS=0、RW=1、E=1时，忙信号输出到DB7，由P0.7读入
  72   1           while(P0_7==1);      //由P0.7读入1，表示1602液晶忙，需要等待
  73   1           E=0;                 //读完以后，恢复E的电平
  74   1      } 
  75          
  76          //---------------------------------------
  77          //名称：1600写命令函数
  78          //适用：给力者GL9单片机开发学习系统
  79          //公司：宁波芯动电子有限公司
  80          //网址：www.MovingChip.com
  81          //日期：20120914
  82          //---------------------------------------
  83          void LCD1602_Write_com(unsigned char combuf)
  84          { 
  85   1           RS=0;                //选择指令寄存器
  86   1           RW=0;                //选择写状态
  87   1           P0=combuf;           //将命令字通过P0口送至DB
  88   1           E=1;                 //E高电平将命令字写入1602液晶
  89   1           E=0;                 //写完以后，恢复E的电平
  90   1      } 
  91          
  92          //---------------------------------------
  93          //名称：1602写命令函数(带忙检测)
  94          //适用：给力者GL9单片机开发学习系统
  95          //公司：宁波芯动电子有限公司
  96          //网址：www.MovingChip.com
  97          //日期：20120914
  98          //---------------------------------------
  99          void LCD1602_Write_com_busy(unsigned char combuf)
 100          { 
 101   1           LCD1602_busy();            //调用忙检测函数
 102   1           LCD1602_Write_com(combuf); //调用忙检测函数
 103   1      } 
 104          
 105          //---------------------------------------
 106          //名称：1602写数据函数(带忙检测)
 107          //适用：给力者GL9单片机开发学习系统
 108          //公司：宁波芯动电子有限公司
 109          //网址：www.MovingChip.com
 110          //日期：20120914
 111          //---------------------------------------
 112          void LCD1602_Write_data_busy(unsigned char databuf)
 113          { 
 114   1           LCD1602_busy();      //调用忙检测函数
 115   1           RS=1;                //选择数据寄存器
 116   1           RW=0;                //选择写状态
 117   1           P0=databuf;          //将命令字通过P0口送至DB
C51 COMPILER V7.00  TEST43                                                                 09/19/2012 10:30:32 PAGE 3   

 118   1           E=1;                 //E高电平将命令字写入1602液晶
 119   1           E=0;                 //写完以后，恢复E的电平
 120   1      } 
 121          
 122          //---------------------------------------
 123          //名称：1602液晶显示地址写函数
 124          //适用：给力者GL9单片机开发学习系统
 125          //公司：宁波芯动电子有限公司
 126          //网址：www.MovingChip.com
 127          //日期：20120914
 128          //---------------------------------------
 129          void LCD1602_Write_address(unsigned char x,unsigned char y)
 130          { 
 131   1           x&=0x0f;             //列地址限制在0-15间
 132   1           y&=0x01;             //行地址限制在0-1间
 133   1           if(y==0)             //如果是第一行
 134   1               LCD1602_Write_com_busy(x|0x80);        //将列地址写入
 135   1           else                 //如果是第二行
 136   1               LCD1602_Write_com_busy((x+0x40)|0x80); //将列地址写入
 137   1      } 
 138          
 139          //---------------------------------------
 140          //名称：1602液晶初始化函数
 141          //适用：给力者GL9单片机开发学习系统
 142          //公司：宁波芯动电子有限公司
 143          //网址：www.MovingChip.com
 144          //日期：20120914
 145          //---------------------------------------
 146          void LCD1602_init(void)
 147          { 
 148   1           Delay1602(1500);               //调用延时函数
 149   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 150   1           Delay1602(500);                //调用延时函数
 151   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 152   1           Delay1602(500);                //调用延时函数
 153   1           LCD1602_Write_com(0x38);       //8位数据总线，两行显示模式，5*7点阵显示
 154   1           LCD1602_Write_com_busy(0x38);  //8位数据总线，两行显示模式，5*7点阵显示
 155   1           LCD1602_Write_com_busy(0x08);  //显示功能关，无光标
 156   1           LCD1602_Write_com_busy(0x01);  //清屏
 157   1           LCD1602_Write_com_busy(0x06);  //写入新的数据后，光标右移，显示屏不移动
 158   1           LCD1602_Write_com_busy(0x0C);  //显示功能开，无光标
 159   1      } 
 160          
 161          //---------------------------------------
 162          //名称：1602液晶指定地址显示函数
 163          //适用：给力者GL9单片机开发学习系统
 164          //公司：宁波芯动电子有限公司
 165          //网址：www.MovingChip.com
 166          //日期：20120914
 167          //---------------------------------------
 168          void LCD1602_Disp(unsigned char x,unsigned char y,unsigned char buf)
 169          { 
 170   1           LCD1602_Write_address(x,y);    //先将地址信息写入
 171   1           LCD1602_Write_data_busy(buf);  //再写入要显示的数据
 172   1      } 
 173          
 174          //---------------------------------------
 175          //名称: 主函数
 176          //适用：给力者GL9单片机开发学习系统
 177          //公司：宁波芯动电子有限公司
 178          //网址：www.MovingChip.com
 179          //日期：20120914
C51 COMPILER V7.00  TEST43                                                                 09/19/2012 10:30:32 PAGE 4   

 180          //---------------------------------------
 181          void main(void)            //主函数,单片机开机后就是从这个函数开始运行
 182          {
 183   1      
 184   1          LCD1602_init();        //调用1602液晶初始化函数
 185   1      
 186   1          //***定时器Timer0初始化***
 187   1          TMOD&=0xF0;            //将TMOD的低4位定时器0控制部分清零
 188   1          TMOD|=0x01;            //设置定时器0为方式1
 189   1          TL0=0xFF;              //设置定时器0初值低8位
 190   1          TH0=0x4B;              //设置定时器0初值高8位
 191   1          TR0=1;                 //启动定时器0
 192   1          ET0=1;                 //Timer0中断允许
 193   1          //**********************
 194   1      
 195   1          //***开全局中断设置****
 196   1          //定时器Timer0设置了中断允许,此处要开全局中断
 197   1          EA=1;                  //开全局中断
 198   1          //*********************
 199   1      
 200   1          while(1)               //死循环,单片机初始化后,将一直运行这个死循环
 201   1          {
 202   2      
 203   2          
 204   2      
 205   2          //**1602液晶显示0-9999**
 206   2              LCD1602_Disp(0,0,DISbuf/1000+'0');       //在第1行的第1列显示千位
 207   2              LCD1602_Disp(1,0,(DISbuf%1000)/100+'0'); //在第1行的第2列显示百位
 208   2              LCD1602_Disp(2,0,(DISbuf%100)/10+'0');   //在第1行的第3列显示十位
 209   2              LCD1602_Disp(3,0,DISbuf%10+'0');         //在第1行的第4列显示个位
 210   2          //**********************
 211   2      
 212   2          }
 213   1      }
 214          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    325    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      3    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
