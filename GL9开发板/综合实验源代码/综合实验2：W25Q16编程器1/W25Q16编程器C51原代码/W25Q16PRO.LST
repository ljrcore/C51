C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE W25Q16PRO
OBJECT MODULE PLACED IN W25Q16PRO.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE W25Q16PRO.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                ¸øÁ¦Õßµ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³£¬¿ª·¢Ñ§Ï°¶¼¸øÁ¦£¡              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     Ñ§Ï°51µ¥Æ¬»ú£¬ÆäÊµ¿ÉÒÔºÜ¼òµ¥                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                Äþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          #include <AT89X52.h>       //µ÷ÓÃ51µ¥Æ¬»úµÄÍ·ÎÄ¼þ
   9          #include <Intrins.h>       //Òò±¾ÀýÐèÒªÊ¹ÓÃ¿Õ²Ù×÷£¬±ØÐëµ÷ÓÃÕâ¸öÍ·ÎÄ¼þ
  10          
  11          //---------------------------------------
  12          //W25Q16Ïà¹ØI/OÉèÖÃ
  13          sbit CS          = P3^6;        //Ñ¡Í¨  
  14          sbit DIO         = P3^5;   //µ¥Æ¬»úÊä³ö
  15          sbit DO          = P3^7;        //FLASHÊä³ö
  16          sbit SCLK        = P3^4;        //Ê±ÖÓ
  17          //---------------------------------------
  18          
  19          //***************************************************************
  20          #define W25X_ReadStatus       0x05              //¶Á×´Ì¬¼Ä´æÆ÷
  21          #define W25X_WriteStatus      0x01              //Ð´×´Ì¬¼Ä´æÆ÷
  22          #define W25X_ReadDATA8        0x03              //ÆÕ¶Á_Êý¾Ý
  23          #define W25X_FastRead         0x0B              //¿ì¶Á_Êý¾Ý
  24          #define W25X_DualOutput       0x3B              //¿ì¶Á_Ë«Êä³ö
  25          #define W25X_Write            0x02              //Ð´_Êý¾Ý_0~255¸ö×Ö½Ú
  26          #define W25X_S_Erase          0x20              //ÉÈÇø²Á³ý4KB
  27          #define W25X_B_Erase          0xD8              //¿éÇø²Á³ý64KB
  28          #define W25X_C_Erase          0xC7              //ÕûÆ¬¸ñÊ½»¯
  29          #define W25X_PowerDown        0xB9              //´ý»ú
  30          #define W25X_PowerON_ID       0xAB              //¿ª»ú»òÊÇ¶ÁID
  31          #define W25X_JEDEC_ID         0x9F              //Ê®ÁùÎ»µÄJEDEC_ID
  32          #define W25X_WriteEnable      0x06              //Ð´³äÐí
  33          #define W25X_WriteDisable     0x04              //Ð´½ûÖ¹
  34          
  35          unsigned char ComBuf[21];//´®¿ÚÍ¨Ñ¶Êý¾Ý»º´æ£¬·¢ËÍºÍ½ÓÊÕ¶¼Ê¹ÓÃ
  36          unsigned int  nTimeOut;//³¬Ê±¼ÆÊý
  37          unsigned char Buf[16];
  38          unsigned char n;        
  39          //---------------------------------------
  40          //Ãû³Æ: SPIÐ´ÈëÒ»¸ö×Ö½Úº¯Êý
  41          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
  42          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
  43          //ÍøÖ·£ºwww.MovingChip.com
  44          //ÈÕÆÚ£º20120916
  45          //---------------------------------------
  46          void Send_OneByte(unsigned char DATA8) //´ÓSPI·¢8Î»Êý
  47          {                                                                   //ÉÏÉýÑØÐ´Èë
  48   1         unsigned char x;      
  49   1         for (x=0;x<8;x++)
  50   1         { 
  51   2                      SCLK=0;
  52   2                      if(DATA8&0x80)DIO=1;
  53   2                      else DIO=0;
  54   2                      SCLK=1;
  55   2                      DATA8=DATA8<<1;
C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 2   

  56   2              }     
  57   1      } 
  58          
  59          //---------------------------------------
  60          //Ãû³Æ: SPI¶Á³öÒ»¸ö×Ö½Úº¯Êý
  61          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
  62          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
  63          //ÍøÖ·£ºwww.MovingChip.com
  64          //ÈÕÆÚ£º20120916
  65          //---------------------------------------
  66          unsigned char Read_OneByte(void)     //´ÓSPIÊÕ8Î»Êý
  67             {                                                     //ÏÂ½µÑØÊä³ö
  68   1         unsigned char DATA8;
  69   1         unsigned char x;
  70   1         SCLK=1;
  71   1         DATA8=0x00;
  72   1         for (x=0;x<8;x++)
  73   1         { 
  74   2                      _nop_();
  75   2                      SCLK=0;
  76   2                      DATA8=DATA8<<1;
  77   2                      if(DO)DATA8=DATA8|0x01;
  78   2                      SCLK=1;  
  79   2              }
  80   1         return (DATA8);   
  81   1      }
  82          //---------------------------------------
  83          //Ãû³Æ: Ð´ÔÊÐíº¯Êý
  84          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
  85          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
  86          //ÍøÖ·£ºwww.MovingChip.com
  87          //ÈÕÆÚ£º20120916
  88          //---------------------------------------
  89          void WriteEnable  (void)
  90          {
  91   1         SCLK=1;
  92   1         CS=0;
  93   1         Send_OneByte(W25X_WriteEnable);  
  94   1         CS=1;
  95   1         SCLK=1;
  96   1      }
  97          //---------------------------------------
  98          //Ãû³Æ: Ð´½ûÖ¹º¯Êý
  99          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 100          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 101          //ÍøÖ·£ºwww.MovingChip.com
 102          //ÈÕÆÚ£º20120916
 103          //---------------------------------------
 104          void WriteDisable (void)
 105          {
 106   1         SCLK=1;
 107   1         CS=0;
 108   1         Send_OneByte(W25X_WriteDisable);  
 109   1         CS=1;
 110   1         SCLK=1;
 111   1      }
 112          //---------------------------------------
 113          //Ãû³Æ: ÅÐ¶ÏW25Q16Ã¦º¯Êý
 114          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 115          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 116          //ÍøÖ·£ºwww.MovingChip.com
 117          //ÈÕÆÚ£º20120916
C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 3   

 118          //---------------------------------------
 119          unsigned char W25X_BUSY_OrNot (void)    //ÔÚ¶ÁºÍÐ´Ö®Ç°µÃÏÈÅÐ¶ÏFLASHÊÇ·ñBUSY
 120          {                                                                                       //BUSYµÄÔ­ÒòÊÇ²Á³ý£¬»òÊÇÁ¬Ðø¶ÁÐ´
 121   1         unsigned char k;                                     //Èç¹ûÃ»ÓÐÒÔÉÏ·½Ê½£¬²»±ØÅÐ¶¨¿ÉÒÔÐ´¶Á  
 122   1         SCLK=1;
 123   1         _nop_();
 124   1         CS=0;
 125   1         Send_OneByte(W25X_ReadStatus);   //¶Á×´Ì¬¼Ä´æÆ÷
 126   1         k=Read_OneByte();                                    //¶ÁÒ»¸ö×Ö½Ú
 127   1         k=k&0x01;
 128   1         CS=1;
 129   1              _nop_();
 130   1         SCLK=1;
 131   1         return k;                         //·µ»Ø1±íÊ¾Ã¦£¬·µ»Ø0±íÊ¾²»Ã¦   
 132   1      }       
 133          //---------------------------------------
 134          //Ãû³Æ: ÍùFLASH´æ´¢Æ÷ÖÐÐ´Êý¾Ýº¯Êý
 135          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 136          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 137          //ÍøÖ·£ºwww.MovingChip.com
 138          //ÈÕÆÚ£º20120916
 139          //---------------------------------------
 140          void W25X_Flash_Byte_Write(unsigned char AddreH,unsigned char AddreM,unsigned char AddreL)    
 141          {                                                                
 142   1         unsigned char J;   //¼Æ×Ö½ÚÊý
 143   1         while(W25X_BUSY_OrNot ());  //ÅÐBUSY µÈµ½FlashÏÐ²ÅÄÜ²Ù×÷
 144   1         WriteEnable();   //Ð´ÔÊÐí
 145   1         SCLK=1;   
 146   1              _nop_();
 147   1              _nop_();
 148   1         CS=0;
 149   1         Send_OneByte(W25X_Write);  //ÃüÁî
 150   1         Send_OneByte(AddreH);
 151   1         Send_OneByte(AddreM);
 152   1         Send_OneByte(AddreL);
 153   1         for (J=0;J<16;J++)
 154   1         {
 155   2              Send_OneByte(Buf[J]); //Ð´×Ö½Ú
 156   2              }
 157   1         CS=1;
 158   1         _nop_();
 159   1              _nop_();
 160   1         SCLK=1;
 161   1         for(J=0;J<200;J++) //ÑÓÊ±Ò»µãµã
 162   1         {
 163   2           _nop_();
 164   2                _nop_();
 165   2         }
 166   1      }       
 167          //---------------------------------------
 168          //Ãû³Æ: ´ÓFLASH´æ´¢Æ÷ÖÐ¶ÁÊý¾Ýº¯Êý
 169          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 170          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 171          //ÍøÖ·£ºwww.MovingChip.com
 172          //ÈÕÆÚ£º20120916
 173          //---------------------------------------
 174          //¶Á³öÄÚÈÝ·ÅÖÃÓÚBuf[]ÖÐ
 175          void W25X_Flash_Byte_Read (unsigned char AddreH,unsigned char AddreM,unsigned char AddreL)  //´ÓFlashÀï¶Á³
             -ö16×Ö½ÚÊý
 176          {
 177   1         unsigned char J;      //¼Æ×Ö½ÚÊý   
 178   1         while(W25X_BUSY_OrNot()==1);  //ÅÐBUSY
C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 4   

 179   1              _nop_();
 180   1              _nop_();
 181   1         CS=0;
 182   1         Send_OneByte(W25X_ReadDATA8);//ÃüÁî¶Á
 183   1         Send_OneByte(AddreH);
 184   1         Send_OneByte(AddreM);
 185   1         Send_OneByte(AddreL);
 186   1         for (J=0;J<16;J++)
 187   1         {
 188   2              Buf[J]=Read_OneByte();   //¶ÁÒ»¸ö×Ö½Ú
 189   2              }
 190   1         CS=1;
 191   1         _nop_();
 192   1              _nop_();
 193   1         SCLK=1;
 194   1         _nop_();
 195   1              _nop_();
 196   1      }         
 197          
 198          //---------------------------------------
 199          //Ãû³Æ: ÕûÆ¬²Á³ýº¯Êý
 200          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 201          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 202          //ÍøÖ·£ºwww.MovingChip.com
 203          //ÈÕÆÚ£º20120916
 204          //---------------------------------------
 205          void W25X_ChipErase(void)
 206          {
 207   1              WriteEnable();              //Ð´ÔÊÐí
 208   1              SCLK=1;
 209   1              CS=0;
 210   1              Send_OneByte(W25X_C_Erase);//ÕûÆ¬²Á³ýÃüÁî
 211   1              CS=1;                        //´ÓCS=1Ê±¿ªÊ¼Ö´ÐÐ²Á³ý
 212   1              SCLK=1;  
 213   1        }
 214          
 215          //---------------------------------------
 216          //Ãû³Æ: 4KÉÈÇø²Á³ýº¯Êý
 217          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 218          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 219          //ÍøÖ·£ºwww.MovingChip.com
 220          //ÈÕÆÚ£º20120916
 221          //---------------------------------------
 222          void W25X_SectorErase(unsigned char AddreH,unsigned char AddreM,unsigned char AddreL)   //²Á³ý×ÊÁÏÍ¼Ê¾µÄ4KB¿
             -Õ¼ä
 223          {
 224   1         WriteEnable();   //Ð´ÔÊÐí  
 225   1      
 226   1         SCLK=1;
 227   1         CS=0;
 228   1         Send_OneByte(W25X_S_Erase);//ÕûÉÈ²Á³ýÃüÁî
 229   1         Send_OneByte(AddreH);
 230   1         Send_OneByte(AddreM);
 231   1         Send_OneByte(AddreL);
 232   1         CS=1;
 233   1         _nop_();
 234   1         SCLK=1;
 235   1         _nop_();
 236   1              _nop_();
 237   1      } 
 238          //---------------------------------------
 239          //Ãû³Æ: 64K¿éÇø²Á³ýº¯Êý
C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 5   

 240          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 241          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 242          //ÍøÖ·£ºwww.MovingChip.com
 243          //ÈÕÆÚ£º20120916
 244          //---------------------------------------
 245          void W25X_BlockErase(unsigned char AddreH,unsigned char AddreM,unsigned char AddreL)    //²Á³ý×ÊÁÏÍ¼Ê¾µÄ64KB¿
             -Õ¼ä
 246          {
 247   1         WriteEnable();   //Ð´ÔÊÐí
 248   1      
 249   1         SCLK=1;
 250   1         CS=0;
 251   1         Send_OneByte(W25X_B_Erase);//ÕûÉÈ²Á³ýÃüÁî
 252   1         Send_OneByte(AddreH);
 253   1         Send_OneByte(AddreM);
 254   1         Send_OneByte(AddreL);
 255   1         CS=1;
 256   1         _nop_();
 257   1         _nop_();
 258   1         SCLK=1;
 259   1         _nop_();
 260   1         _nop_();
 261   1      } 
 262          //---------------------------------------
 263          //Ãû³Æ: ÑÓÊ±º¯Êý
 264          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 265          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 266          //ÍøÖ·£ºwww.MovingChip.com
 267          //ÈÕÆÚ£º20120916
 268          //---------------------------------------
 269          void Delay(unsigned int s) //
 270          {
 271   1         unsigned int loop;
 272   1         for(loop=s;loop>0;loop--)  
 273   1         {        
 274   2            _nop_();
 275   2         }
 276   1      }
 277          //---------------------------------------
 278          //Ãû³Æ: µÈ´ýÉÏÎ»»ú18×Ö½Úº¯Êý
 279          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 280          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 281          //ÍøÖ·£ºwww.MovingChip.com
 282          //ÈÕÆÚ£º20120914
 283          //---------------------------------------
 284          bit WaitData()
 285          {
 286   1              unsigned char n;
 287   1              RI=0;
 288   1              for(n=0;n<21;n++)
 289   1              {
 290   2                      nTimeOut=0;
 291   2                      while(!RI)
 292   2                      {
 293   3                              nTimeOut++;
 294   3                              if(nTimeOut>10000)
 295   3                              {
 296   4                                      return 0;
 297   4                              }
 298   3                      }
 299   2                      RI=0;
 300   2                      ComBuf[n]=SBUF;
C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 6   

 301   2              }
 302   1              return 1;
 303   1      }
 304          //---------------------------------------
 305          //Ãû³Æ: ÏòÉÏÎ»»ú·¢ËÍ18×Ö½Úº¯Êý
 306          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 307          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 308          //ÍøÖ·£ºwww.MovingChip.com
 309          //ÈÕÆÚ£º20120914
 310          //---------------------------------------
 311          void SendData()
 312          {
 313   1              unsigned char n=0;
 314   1              for(n;n<21;n++)
 315   1              {
 316   2                      TI=0;
 317   2                      SBUF=ComBuf[n];
 318   2                      while(!TI){}
 319   2                      TI=0;
 320   2              }
 321   1      }
 322          //---------------------------------------
 323          //Ãû³Æ: Ö÷º¯Êý
 324          //ÊÊÓÃ£º¸øÁ¦ÕßGL9µ¥Æ¬»ú¿ª·¢Ñ§Ï°ÏµÍ³
 325          //¹«Ë¾£ºÄþ²¨Ð¾¶¯µç×ÓÓÐÏÞ¹«Ë¾
 326          //ÍøÖ·£ºwww.MovingChip.com
 327          //ÈÕÆÚ£º20120914
 328          //---------------------------------------
 329          void main(void)            //Ö÷º¯Êý,µ¥Æ¬»ú¿ª»úºó¾ÍÊÇ´ÓÕâ¸öº¯Êý¿ªÊ¼ÔËÐÐ
 330          {
 331   1          //*****USART´®¿Ú³õÊ¼»¯*****
 332   1              TMOD&=0x0F;            //°ÑTMOD¸ß4Î»Çå0
 333   1              TMOD|=0x20;            //½«TMODµÄM1Î»ÖÃ1£¬ÉèÖÃ³É×Ô¶¯×°ÈëµÄ8Î»¶¨Ê±Æ÷
 334   1         TH1=0xFF;              //ÉèÖÃ²¨ÌØÂÊÎª57600
 335   1         TL1=0xFF;              //ÉèÖÃ²¨ÌØÂÊÎª57600
 336   1         TR1=1;                 //Æô¶¯¶¨Ê±Æ÷T1£¬×÷Îª´®¿Ú²¨ÌØÂÊ·¢ÉúÆ÷
 337   1         SCON=0x50;             //10Î»Òì²½ÊÕ·¢£¬²¨ÌØÂÊÓÉ¶¨Ê±Æ÷¿ØÖÆ£¬ÔÊÐí´®¿Ú½ÓÊÕ
 338   1              ES=0;                  //½ûÖ¹´®¿ÚÖÐ¶Ï
 339   1         //**************************
 340   1              while(1)               //ËÀÑ­»·,µ¥Æ¬»ú³õÊ¼»¯ºó,½«Ò»Ö±ÔËÐÐÕâ¸öËÀÑ­»·
 341   1              {    
 342   2                      if(WaitData()==1)   //Èç¹û½ÓÊÕ³É¹¦
 343   2                      {               
 344   3                              if(ComBuf[0]==1) //Èç¹ûÉÏÎ»»ú·¢1£¬Îª¶ÁÊ¶±ðÂë
 345   3                              {
 346   4                                      ComBuf[2]=6;
 347   4                              ComBuf[3]=2;
 348   4                              ComBuf[4]=4;  
 349   4                                      SendData();  //½«Ê¶±ðÂë624·¢¸øÉÏÎ»»ú
 350   4                              }
 351   3                              else if(ComBuf[0]==2) //Èç¹ûÉÏÎ»»ú·¢2£¬ÎªÐ´W25Q16
 352   3                              {
 353   4                                      SendData();//»ØÓ¦ÉÏÎ»»ú±íÊ¾½øÈëÐ´Æ÷¼þ×´Ì¬£¬¿ÉÒÔ·¢À´Êý¾Ý         
 354   4                                      while(1)
 355   4                                      {
 356   5                                              if(WaitData()==1&&ComBuf[1]==0x01)//Èç¹û½ÓÊÕÊý¾Ý³É¹¦²¢ÇÒComBuf[0]==1±íÊ¾¼ÌÐøÐ´
 357   5                                              {                                               
 358   6                                                      for(n=0;n<16;n++)
 359   6                                                      {
 360   7                                                              Buf[n]=ComBuf[n+2];  //°Ñ½ÓÊÕµ½µÄCOMBUF[2]-[17]ÄÚµÄÊý¾ÝÒÆµ½
 361   7                                                              //BUF[0]-[15]ÄÚ£¬ÒÔ±ãÌ×ÓÃÁ¬ÐøÐ´º¯Êý¸ñÊ½
 362   7                                                      }               
C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 7   

 363   6                                                      W25X_Flash_Byte_Write(ComBuf[18],ComBuf[19],ComBuf[20]);//ComBuf[2~17]Îª´ýÐ´ÈëÊý¾Ý¿é
 364   6                                                      SendData();                                     //Í¨ÖªÉÏÎ»»ú¼ÌÐø·¢                      
 365   6                                              }       
 366   5                                              else
 367   5                                              {
 368   6                                                      break;  //ÍË³öwhile(1)
 369   6                                              }
 370   5                                      }               
 371   4                              }       
 372   3                              else if(ComBuf[0]==3) //Èç¹ûÉÏÎ»»ú·¢3£¬Îª¶ÁW25Q16
 373   3                              {
 374   4                                      SendData();//»ØÓ¦ÉÏÎ»»ú±íÊ¾½øÈë¶Á×´Ì¬                           
 375   4                                      while(1)
 376   4                                      {
 377   5                                              if(WaitData()==1&&ComBuf[1]==1)//Èç¹û½ÓÊÕÊý¾Ý³É¹¦²¢ÇÒComBuf[0]==1±íÊ¾¼ÌÐø¶Á
 378   5                                              {
 379   6                                                      W25X_Flash_Byte_Read(ComBuf[18],ComBuf[19],ComBuf[20]);//´ÓAddress¿ªÊ¼£¬Á¬Ðø¶Á16¸ö×Ö½Ú£¬·ÅÈëBUF[]Àï
 380   6                                                      for(n=0;n<16;n++)
 381   6                                                      {
 382   7                                                              ComBuf[n+2]=Buf[n];                             
 383   7                                                      }                       
 384   6                                                      SendData();                             
 385   6                                              }
 386   5                                              else
 387   5                                              {
 388   6                                                      break;  //ÍË³öwhile(1)
 389   6                                              }
 390   5                                      }               
 391   4                              }
 392   3                              else if(ComBuf[0]==4) //Èç¹ûÉÏÎ»»ú·¢4£¬ÎªÕûÆ¬²Á³ý(2M bytes)
 393   3                              {
 394   4                                      SendData();//»ØÓ¦ÉÏÎ»»ú±íÊ¾½øÈëÕûÆ¬²Á³ý                                 
 395   4                                      W25X_ChipErase();                               
 396   4                                      Delay(50000); //
 397   4                              }
 398   3                              else if(ComBuf[0]==5) //Èç¹ûÉÏÎ»»ú·¢5£¬Îª¿éÇø²Á³ý(64K bytes)
 399   3                              {
 400   4                                      SendData();//»ØÓ¦ÉÏÎ»»ú±íÊ¾½øÈë¿éÇø²Á³ý                         
 401   4                                      W25X_BlockErase(ComBuf[18],ComBuf[19],0);                               
 402   4                                      Delay(8000); //
 403   4                              }
 404   3                              else if(ComBuf[0]==6) //Èç¹ûÉÏÎ»»ú·¢6£¬ÎªÉÈÇø²Á³ý(4K bytes)
 405   3                              {
 406   4                                      SendData();//»ØÓ¦ÉÏÎ»»ú±íÊ¾½øÈëÉÈÇø²Á³ý                         
 407   4                                      W25X_SectorErase(ComBuf[18],ComBuf[19],0);                              
 408   4                                      Delay(8000); //
 409   4                              }
 410   3                      }     
 411   2              }
 412   1      }
 413          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    586    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     40    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V7.00  W25Q16PRO                                                              10/17/2013 12:34:01 PAGE 8   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
