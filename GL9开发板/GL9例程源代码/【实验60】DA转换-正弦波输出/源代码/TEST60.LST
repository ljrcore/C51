C51 COMPILER V7.00  TEST60                                                                 09/18/2012 21:41:33 PAGE 1   


C51 COMPILER V7.00, COMPILATION OF MODULE TEST60
OBJECT MODULE PLACED IN TEST60.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE TEST60.c BROWSE DEBUG OBJECTEXTEND

stmt level    source

   1          ////////////////////////////////////////////////////////////////////////////
   2          //                给力者单片机开发学习系统，开发学习都给力！              //
   3          ////////////////////////////////////////////////////////////////////////////
   4          //                     学习51单片机，其实可以很简单                       //
   5          ////////////////////////////////////////////////////////////////////////////
   6          //                宁波芯动电子有限公司  www.MovingChip.com                //
   7          ////////////////////////////////////////////////////////////////////////////
   8          
   9          #include <AT89X52.h>       //调用51单片机的头文件
  10          #include <Intrins.h>       //因本例需要使用空操作，必须调用这个头文件
  11          
  12          unsigned char code tab[]={
  13          0x80,0x83,0x86,0x89,0x8c,0x8f,0x92,0x95,0x99,0x9c,
  14          0x9f,0xa2,0xa5,0xa8,0xab,0xae,0xb1,0xb4,0xb6,0xb9,
  15          0xbc,0xbf,0xc2,0xc4,0xc7,0xc9,0xcc,0xce,0xd1,0xd3,
  16          0xd6,0xd8,0xda,0xdc,0xdf,0xe1,0xe3,0xe5,0xe7,0xe8,
  17          0xea,0xec,0xee,0xef,0xf1,0xf2,0xf3,0xf5,0xf6,0xf7,
  18          0xf8,0xf9,0xfa,0xfb,0xfc,0xfd,0xfd,0xfe,0xfe,0xff,
  19          0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xfe,
  20          0xfe,0xfd,0xfd,0xfc,0xfb,0xfb,0xfa,0xf9,0xf8,0xf7,
  21          0xf5,0xf4,0xf3,0xf1,0xf0,0xee,0xed,0xeb,0xe9,0xe8,
  22          0xe6,0xe4,0xe2,0xe0,0xde,0xdb,0xd9,0xd7,0xd5,0xd2,
  23          0xd0,0xcd,0xcb,0xc8,0xc6,0xc3,0xc0,0xbe,0xbb,0xb8,
  24          0xb5,0xb2,0xaf,0xac,0xa9,0xa6,0xa3,0xa0,0x9d,0x9a,
  25          0x97,0x94,0x91,0x8e,0x8b,0x88,0x84,0x81,0x7e,0x7b,
  26          0x78,0x75,0x72,0x6e,0x6b,0x68,0x65,0x62,0x5f,0x5c,
  27          0x59,0x56,0x53,0x50,0x4d,0x4a,0x47,0x45,0x42,0x3f,
  28          0x3c,0x3a,0x37,0x34,0x32,0x2f,0x2d,0x2b,0x28,0x26,
  29          0x24,0x22,0x20,0x1d,0x1b,0x1a,0x18,0x16,0x14,0x12,
  30          0x11,0xf,0xe,0xc,0xb,0xa,0x9,0x7,0x6,0x5,
  31          0x4,0x4,0x3,0x2,0x2,0x1,0x1,0x0,0x0,0x0,
  32          0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1,0x1,0x2,
  33          0x2,0x3,0x4,0x5,0x6,0x7,0x8,0x9,0xa,0xb,
  34          0xd,0xe,0x10,0x11,0x13,0x15,0x16,0x18,0x1a,0x1c,
  35          0x1e,0x20,0x22,0x24,0x27,0x29,0x2b,0x2e,0x30,0x33,
  36          0x35,0x38,0x3a,0x3d,0x40,0x43,0x45,0x48,0x4b,0x4e,
  37          0x51,0x54,0x57,0x5a,0x5d,0x60,0x63,0x66,0x69,0x6c,
  38          0x6f,0x73,0x76,0x79,0x7c
  39          };
  40          
  41          //---------------------------------------
  42          //软件模拟IIC相关I/O设置
  43          sbit SCL=P1^7;             //PCF8591T的 SCL 引脚接于单片机的P1^7引脚上
  44          sbit SDA=P1^6;             //PCF8591T的 SDA 引脚接于单片机的P1^6引脚上
  45          //---------------------------------------
  46          
  47          //---------------------------------------
  48          //A/D转换用寄存器设置
  49          unsigned char ADbuf;       //设置8位的寄存器用来暂存A/D转换结果
  50          //---------------------------------------
  51          
  52          //---------------------------------------
  53          //名称：生IIC启动信号函数
  54          //适用：给力者GL9单片机开发学习系统
  55          //公司：宁波芯动电子有限公司
C51 COMPILER V7.00  TEST60                                                                 09/18/2012 21:41:33 PAGE 2   

  56          //网址：www.MovingChip.com
  57          //日期：20120914
  58          //---------------------------------------
  59          void IICstart(void)
  60          { 
  61   1           SDA=1;                //先将SDA=1，以准备在SCL=1时，将SDA=0
  62   1           SCL=1;                //时钟总线拉高 
  63   1           _nop_();                   //略做延时
  64   1           _nop_();                   //略做延时
  65   1           SDA=0;                //SCL=1时，将SDA拉低即产生启动信号 
  66   1           _nop_();                   //略做延时
  67   1           _nop_();                   //略做延时
  68   1           SCL=0;                //将SCL=0，完成启动信号操作      
  69   1      } 
  70          
  71          //---------------------------------------
  72          //名称：IIC停止信号函数
  73          //适用：给力者GL9单片机开发学习系统
  74          //公司：宁波芯动电子有限公司
  75          //网址：www.MovingChip.com
  76          //日期：20120914
  77          //---------------------------------------
  78          void IICstop(void)
  79          { 
  80   1           SDA=0;                //先将SDA=0，以准备在SCL=1时，将SDA=1
  81   1           SCL=1;                //时钟总线拉高 
  82   1           _nop_();                   //略做延时
  83   1           _nop_();                   //略做延时
  84   1           SDA=1;                //SCL=1时，将SDA拉高即产生停止信号 
  85   1           _nop_();                   //略做延时
  86   1           _nop_();                   //略做延时
  87   1           SCL=0;                //将SCL=0，完成启动信号操作      
  88   1      } 
  89          
  90          //---------------------------------------
  91          //名称：向IIC总线写入1个字节函数
  92          //适用：给力者GL9单片机开发学习系统
  93          //公司：宁波芯动电子有限公司
  94          //网址：www.MovingChip.com
  95          //日期：20120914
  96          //---------------------------------------
  97          void Write1Byte(unsigned char Buf1)
  98          { 
  99   1           unsigned char k;      //1个字节要分8次写入，需要定义一个寄存器用来计数
 100   1           for(k=0;k<8;k++)      //做一个8次的循环，每次写入1位，需要写8次
 101   1           {
 102   2               if(Buf1&0x80)     //从最高位开始写 
 103   2               {
 104   3                   SDA=1;        //如果欲写入数据为1，就将数据线置1
 105   3               }
 106   2               else
 107   2               {
 108   3                   SDA=0;        //如果欲写入数据为0，就将数据线写0 
 109   3               }
 110   2               _nop_();          //略做延时
 111   2               _nop_();          //略做延时
 112   2               SCL=1;            //时钟线做一个上升沿，将一位数据写入
 113   2               Buf1=Buf1<<1;     //数据左移一位，将下次要写入的位数据移到最高位
 114   2               _nop_();          //略做延时
 115   2               SCL=0;            //将SCL=0，以准备通过上升沿将数据写入
 116   2               _nop_();          //略做延时
 117   2           }
C51 COMPILER V7.00  TEST60                                                                 09/18/2012 21:41:33 PAGE 3   

 118   1           SDA=1;                //将SDA=1，准备读应答信号
 119   1           _nop_();              //略做延时
 120   1           SCL=1;                //将SCL=1，做个上升沿准备读应答信号
 121   1           _nop_();              //略做延时
 122   1           _nop_();              //略做延时
 123   1           SCL=0;                //将SCL=0，结束应答信号读操作
 124   1      } 
 125          
 126          //---------------------------------------
 127          //名称：从IIC总线读入1个字节函数
 128          //适用：给力者GL9单片机开发学习系统
 129          //公司：宁波芯动电子有限公司
 130          //网址：www.MovingChip.com
 131          //日期：20120914
 132          //---------------------------------------
 133          unsigned char Read1Byte(void)
 134          { 
 135   1           unsigned char k;      //1个字节要分8次读出，需要定义一个寄存器用来计数
 136   1           unsigned char t=0;    //定义一个寄存器用保存读出数据
 137   1           for(k=0;k<8;k++)      //做一个8次的循环，每次读入1位，需要读8次
 138   1           {
 139   2               t=t<<1;           //数据左移一位，空出最低位以准备保存读入的一位数据
 140   2               SDA=1;            //将SDA写1准备读
 141   2               SCL=1;            //将SCL=1，做个上升沿准备读一位数据
 142   2               _nop_();          //略做延时
 143   2               _nop_();          //略做延时
 144   2               if(SDA==1)        //读一位数据，并判断 
 145   2               {
 146   3                   t=t|0x01;     //如果读入数据为1，就将接收缓冲区最低一位置1
 147   3               }
 148   2               else
 149   2               {
 150   3                   t=t&0xfe;     //如果读入数据为0，就将接收缓冲区最低一位写0
 151   3               }
 152   2               SCL=0;            //SCL恢复为0，结束一位数据读操作
 153   2               _nop_();          //略做延时
 154   2               _nop_();          //略做延时
 155   2           }
 156   1           return t;             //将读入的一个字节返回
 157   1      } 
 158          
 159          //---------------------------------------
 160          //名称：软件模拟IIC向PCF8591指定地址写一个字节函数
 161          //适用：给力者GL9单片机开发学习系统
 162          //公司：宁波芯动电子有限公司
 163          //网址：www.MovingChip.com
 164          //日期：20120914
 165          //---------------------------------------
 166          void WritePCF8591(unsigned char Databuf)
 167          {                          //直接调用本函数即可启动PCF8591的D/A转换
 168   1          IICstart();            //IIC启动信号
 169   1      
 170   1          Write1Byte(0x90);      //发送PCF8591的器件地址和写信号
 171   1      
 172   1          Write1Byte(0x40);      //发送器件子地址
 173   1      
 174   1          Write1Byte(Databuf);   //发送数据
 175   1      
 176   1          IICstop();             //产生IIC停止信号
 177   1      }
 178          
 179          //---------------------------------------
C51 COMPILER V7.00  TEST60                                                                 09/18/2012 21:41:33 PAGE 4   

 180          //名称：软件模拟IIC从PCF8563指定地址读一个字节函数
 181          //适用：给力者GL9单片机开发学习系统
 182          //公司：宁波芯动电子有限公司
 183          //网址：www.MovingChip.com
 184          //日期：20120914
 185          //---------------------------------------
 186          unsigned ReadPCF8591(unsigned char Ch)
 187          {                          //直接调用本函数即可从PCF8591的Ch通道读出数据返回
 188   1          unsigned char buf;     //定义一个寄存器用来暂存读出的数据
 189   1          IICstart();            //IIC启动信号
 190   1      
 191   1          Write1Byte(0x90);      //发送PCF8591的器件地址和写信号
 192   1      
 193   1          Write1Byte(0x40|Ch);   //发送器件通道参数Ch=0-3
 194   1      
 195   1          IICstart();            //IIC启动信号
 196   1      
 197   1          Write1Byte(0x91);      //发送PCF8591的器件地址和读信号
 198   1      
 199   1          buf=Read1Byte();//读一个字节数据
 200   1      
 201   1          IICstop();             //产生IIC停止信号
 202   1      
 203   1          return(buf);           //将读出数据返回
 204   1      }
 205          
 206          //---------------------------------------
 207          //名称: 主函数
 208          //适用：给力者GL9单片机开发学习系统
 209          //公司：宁波芯动电子有限公司
 210          //网址：www.MovingChip.com
 211          //日期：20120914
 212          //---------------------------------------
 213          void main(void)            //主函数,单片机开机后就是从这个函数开始运行
 214          {
 215   1              unsigned char i;  
 216   1          unsigned int  l;
 217   1          while(1)               //死循环,单片机初始化后,将一直运行这个死循环
 218   1          {
 219   2                      for(i=0;i<255;i++)
 220   2                  {
 221   3                      WritePCF8591(tab[i]);        //利用输入参数进行D/A转换
 222   3                              for(l=0;l<2000;l++);
 223   3                      }
 224   2          }
 225   1      }
 226          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    178    ----
   CONSTANT SIZE    =    255    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
